module.exports=[97380,a=>{"use strict";var b,c,d,e,f,g=a.i(44373),h=a.i(67309),i=a.i(35235),j=a.i(55960),k=a.i(28012),l=a.i(77686),m=a.i(586),n=a.i(90074),o=a.i(56312),p=a.i(96335);class q{contextChange(a){let b=new p.UniformGroup({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new h.Matrix,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),c=a.limits.maxBatchableTextures,d=(0,i.compileHighShaderGlProgram)({name:"graphics",bits:[j.colorBitGl,(0,k.generateTextureBatchBitGl)(c),l.localUniformBitGl,m.roundPixelsBitGl]});this.shader=new o.Shader({glProgram:d,resources:{localUniforms:b,batchSamplers:(0,n.getBatchSamplersUniformGroup)(c)}})}execute(a,b){let c=b.context,d=c.customShader||this.shader,e=a.renderer,{batcher:f,instructions:g}=e.graphicsContext.getContextRenderData(c);d.groups[0]=e.globalUniforms.bindGroup,e.state.set(a.state),e.shader.bind(d),e.geometry.bind(f.geometry,d.glProgram);let h=g.instructions;for(let a=0;a<g.instructionSize;a++){let b=h[a];if(b.size){for(let a=0;a<b.textures.count;a++)e.texture.bind(b.textures.textures[a],a);e.geometry.draw(b.topology,b.size,b.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}q.extension={type:[g.ExtensionType.WebGLPipesAdaptor],name:"graphics"};var r=a.i(84239),s=a.i(71805),t=a.i(51983);class u{init(){let a=(0,i.compileHighShaderGlProgram)({name:"mesh",bits:[l.localUniformBitGl,r.textureBitGl,m.roundPixelsBitGl]});this._shader=new o.Shader({glProgram:a,resources:{uTexture:s.Texture.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new h.Matrix}}}})}execute(a,b){let c=a.renderer,d=b._shader;if(d){if(!d.glProgram)return void(0,t.warn)("Mesh shader has no glProgram",b.shader)}else{d=this._shader;let a=b.texture,c=a.source;d.resources.uTexture=c,d.resources.uSampler=c.style,d.resources.textureUniforms.uniforms.uTextureMatrix=a.textureMatrix.mapCoord}d.groups[100]=c.globalUniforms.bindGroup,d.groups[101]=a.localUniformsBindGroup,c.encoder.draw({geometry:b._geometry,shader:d,state:b.state})}destroy(){this._shader.destroy(!0),this._shader=null}}u.extension={type:[g.ExtensionType.WebGLPipesAdaptor],name:"mesh"};var v=a.i(45287);class w{constructor(){this._tempState=v.State.for2d(),this._didUploadHash={}}init(a){a.renderer.runners.contextChange.add(this)}contextChange(){this._didUploadHash={}}start(a,b,c){let d=a.renderer,e=this._didUploadHash[c.uid];d.shader.bind(c,e),e||(this._didUploadHash[c.uid]=!0),d.shader.updateUniformGroup(d.globalUniforms.uniformGroup),d.geometry.bind(b,c.glProgram)}execute(a,b){let c=a.renderer;this._tempState.blendMode=b.blendMode,c.state.set(this._tempState);let d=b.textures.textures;for(let a=0;a<b.textures.count;a++)c.texture.bind(d[a],a);c.geometry.draw(b.topology,b.size,b.start)}}w.extension={type:[g.ExtensionType.WebGLPipesAdaptor],name:"batch"};var x=a.i(67663),y=a.i(33057),z=a.i(53507),A=a.i(46629),B=a.i(52776),C=((b=C||{})[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER",b[b.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",b);class D{constructor(a,b){this._lastBindBaseLocation=-1,this._lastBindCallId=-1,this.buffer=a||null,this.updateID=-1,this.byteLength=-1,this.type=b}destroy(){this.buffer=null,this.updateID=-1,this.byteLength=-1,this.type=-1,this._lastBindBaseLocation=-1,this._lastBindCallId=-1}}class E{constructor(a){this._boundBufferBases=Object.create(null),this._minBaseLocation=0,this._nextBindBaseIndex=this._minBaseLocation,this._bindCallId=0,this._renderer=a,this._managedBuffers=new A.GCManagedHash({renderer:a,type:"resource",onUnload:this.onBufferUnload.bind(this),name:"glBuffer"})}destroy(){this._managedBuffers.destroy(),this._renderer=null,this._gl=null,this._boundBufferBases={}}contextChange(){this._gl=this._renderer.gl,this.destroyAll(!0),this._maxBindings=this._renderer.limits.maxUniformBindings}getGlBuffer(a){return a._gcLastUsed=this._renderer.gc.now,a._gpuData[this._renderer.uid]||this.createGLBuffer(a)}bind(a){let{_gl:b}=this,c=this.getGlBuffer(a);b.bindBuffer(c.type,c.buffer)}bindBufferBase(a,b){let{_gl:c}=this;this._boundBufferBases[b]!==a&&(this._boundBufferBases[b]=a,a._lastBindBaseLocation=b,c.bindBufferBase(c.UNIFORM_BUFFER,b,a.buffer))}nextBindBase(a){this._bindCallId++,this._minBaseLocation=0,a&&(this._boundBufferBases[0]=null,this._minBaseLocation=1,this._nextBindBaseIndex<1&&(this._nextBindBaseIndex=1))}freeLocationForBufferBase(a){let b=this.getLastBindBaseLocation(a);if(b>=this._minBaseLocation)return a._lastBindCallId=this._bindCallId,b;let c=0,d=this._nextBindBaseIndex;for(;c<2;){d>=this._maxBindings&&(d=this._minBaseLocation,c++);let a=this._boundBufferBases[d];if(a&&a._lastBindCallId===this._bindCallId){d++;continue}break}return(b=d,this._nextBindBaseIndex=d+1,c>=2)?-1:(a._lastBindCallId=this._bindCallId,this._boundBufferBases[b]=null,b)}getLastBindBaseLocation(a){let b=a._lastBindBaseLocation;return this._boundBufferBases[b]===a?b:-1}bindBufferRange(a,b,c,d){let{_gl:e}=this;c||(c=0),b||(b=0),this._boundBufferBases[b]=null,e.bindBufferRange(e.UNIFORM_BUFFER,b||0,a.buffer,256*c,d||256)}updateBuffer(a){let{_gl:b}=this,c=this.getGlBuffer(a);if(a._updateID===c.updateID)return c;c.updateID=a._updateID,b.bindBuffer(c.type,c.buffer);let d=a.data,e=a.descriptor.usage&B.BufferUsage.STATIC?b.STATIC_DRAW:b.DYNAMIC_DRAW;return d?c.byteLength>=d.byteLength?b.bufferSubData(c.type,0,d,0,a._updateSize/d.BYTES_PER_ELEMENT):(c.byteLength=d.byteLength,b.bufferData(c.type,d,e)):(c.byteLength=a.descriptor.size,b.bufferData(c.type,c.byteLength,e)),c}destroyAll(a=!1){this._managedBuffers.removeAll(a)}onBufferUnload(a,b=!1){let c=a._gpuData[this._renderer.uid];c&&(b||this._gl.deleteBuffer(c.buffer))}createGLBuffer(a){let{_gl:b}=this,c=C.ARRAY_BUFFER;a.descriptor.usage&B.BufferUsage.INDEX?c=C.ELEMENT_ARRAY_BUFFER:a.descriptor.usage&B.BufferUsage.UNIFORM&&(c=C.UNIFORM_BUFFER);let d=new D(b.createBuffer(),c);return a._gpuData[this._renderer.uid]=d,this._managedBuffers.add(a),d}resetState(){this._boundBufferBases=Object.create(null)}}E.extension={type:[g.ExtensionType.WebGLSystem],name:"buffer"};var F=a.i(58422);let G=class a{constructor(a){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this._renderer=a,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(a){this.gl=a,this._renderer.gl=a}init(b){b={...a.defaultOptions,...b};let c=this.multiView=b.multiView;if(b.context&&c&&((0,t.warn)("Renderer created with both a context and multiview enabled. Disabling multiView as both cannot work together."),c=!1),c?this.canvas=F.DOMAdapter.get().createCanvas(this._renderer.canvas.width,this._renderer.canvas.height):this.canvas=this._renderer.view.canvas,b.context)this.initFromContext(b.context);else{let a=this._renderer.background.alpha<1,c=b.premultipliedAlpha??!0,d=b.antialias&&!this._renderer.backBuffer.useBackBuffer;this.createContext(b.preferWebGLVersion,{alpha:a,premultipliedAlpha:c,antialias:d,stencil:!0,preserveDrawingBuffer:b.preserveDrawingBuffer,powerPreference:b.powerPreference??"default"})}}ensureCanvasSize(a){if(!this.multiView){a!==this.canvas&&(0,t.warn)("multiView is disabled, but targetCanvas is not the main canvas");return}let{canvas:b}=this;(b.width<a.width||b.height<a.height)&&(b.width=Math.max(a.width,a.width),b.height=Math.max(a.height,a.height))}initFromContext(a){this.gl=a,this.webGLVersion=a instanceof F.DOMAdapter.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(a),this._renderer.runners.contextChange.emit(a);let b=this._renderer.view.canvas;b.addEventListener("webglcontextlost",this.handleContextLost,!1),b.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(a,b){let c,d=this.canvas;if(2===a&&(c=d.getContext("webgl2",b)),!c&&!(c=d.getContext("webgl",b)))throw Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=c,this.initFromContext(this.gl)}getExtensions(){let{gl:a}=this,b={anisotropicFiltering:a.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:a.getExtension("OES_texture_float_linear"),s3tc:a.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:a.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:a.getExtension("WEBGL_compressed_texture_etc"),etc1:a.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:a.getExtension("WEBGL_compressed_texture_pvrtc")||a.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:a.getExtension("WEBGL_compressed_texture_atc"),astc:a.getExtension("WEBGL_compressed_texture_astc"),bptc:a.getExtension("EXT_texture_compression_bptc"),rgtc:a.getExtension("EXT_texture_compression_rgtc"),loseContext:a.getExtension("WEBGL_lose_context")};if(1===this.webGLVersion)this.extensions={...b,drawBuffers:a.getExtension("WEBGL_draw_buffers"),depthTexture:a.getExtension("WEBGL_depth_texture"),vertexArrayObject:a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:a.getExtension("OES_element_index_uint"),floatTexture:a.getExtension("OES_texture_float"),floatTextureLinear:a.getExtension("OES_texture_float_linear"),textureHalfFloat:a.getExtension("OES_texture_half_float"),textureHalfFloatLinear:a.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:a.getExtension("ANGLE_instanced_arrays"),srgb:a.getExtension("EXT_sRGB")};else{this.extensions={...b,colorBufferFloat:a.getExtension("EXT_color_buffer_float")};let c=a.getExtension("WEBGL_provoking_vertex");c&&c.provokingVertexWEBGL(c.FIRST_VERTEX_CONVENTION_WEBGL)}}handleContextLost(a){a.preventDefault(),this._contextLossForced&&(this._contextLossForced=!1,setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext?.restoreContext()},0))}handleContextRestored(){this.getExtensions(),this._renderer.runners.contextChange.emit(this.gl)}destroy(){let a=this._renderer.view.canvas;this._renderer=null,a.removeEventListener("webglcontextlost",this.handleContextLost),a.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext?.loseContext()}forceContextLoss(){this.extensions.loseContext?.loseContext(),this._contextLossForced=!0}validateContext(a){let b=a.getContextAttributes();b&&!b.stencil&&(0,t.warn)("Provided WebGL context does not have a stencil buffer, masks may not render correctly");let c=this.supports,d=2===this.webGLVersion,e=this.extensions;c.uint32Indices=d||!!e.uint32ElementIndex,c.uniformBufferObject=d,c.vertexArrayObject=d||!!e.vertexArrayObject,c.srgbTextures=d||!!e.srgb,c.nonPowOf2wrapping=d,c.nonPowOf2mipmaps=d,c.msaa=d,c.uint32Indices||(0,t.warn)("Provided WebGL context does not support 32 index buffer, large scenes may not render correctly")}};G.extension={type:[g.ExtensionType.WebGLSystem],name:"context"},G.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2,multiView:!1};var H=a.i(70770),I=a.i(80783),J=((c=J||{})[c.RGBA=6408]="RGBA",c[c.RGB=6407]="RGB",c[c.RG=33319]="RG",c[c.RED=6403]="RED",c[c.RGBA_INTEGER=36249]="RGBA_INTEGER",c[c.RGB_INTEGER=36248]="RGB_INTEGER",c[c.RG_INTEGER=33320]="RG_INTEGER",c[c.RED_INTEGER=36244]="RED_INTEGER",c[c.ALPHA=6406]="ALPHA",c[c.LUMINANCE=6409]="LUMINANCE",c[c.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",c[c.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",c[c.DEPTH_STENCIL=34041]="DEPTH_STENCIL",c),K=((d=K||{})[d.TEXTURE_2D=3553]="TEXTURE_2D",d[d.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",d[d.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",d[d.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",d[d.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",d[d.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",d[d.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",d[d.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",d[d.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",d),L=((e=L||{})[e.CLAMP=33071]="CLAMP",e[e.REPEAT=10497]="REPEAT",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e),M=((f=M||{})[f.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",f[f.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",f[f.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",f[f.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",f[f.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",f[f.UNSIGNED_INT=5125]="UNSIGNED_INT",f[f.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",f[f.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",f[f.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",f[f.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",f[f.BYTE=5120]="BYTE",f[f.SHORT=5122]="SHORT",f[f.INT=5124]="INT",f[f.FLOAT=5126]="FLOAT",f[f.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",f[f.HALF_FLOAT=36193]="HALF_FLOAT",f);let N={uint8x2:M.UNSIGNED_BYTE,uint8x4:M.UNSIGNED_BYTE,sint8x2:M.BYTE,sint8x4:M.BYTE,unorm8x2:M.UNSIGNED_BYTE,unorm8x4:M.UNSIGNED_BYTE,snorm8x2:M.BYTE,snorm8x4:M.BYTE,uint16x2:M.UNSIGNED_SHORT,uint16x4:M.UNSIGNED_SHORT,sint16x2:M.SHORT,sint16x4:M.SHORT,unorm16x2:M.UNSIGNED_SHORT,unorm16x4:M.UNSIGNED_SHORT,snorm16x2:M.SHORT,snorm16x4:M.SHORT,float16x2:M.HALF_FLOAT,float16x4:M.HALF_FLOAT,float32:M.FLOAT,float32x2:M.FLOAT,float32x3:M.FLOAT,float32x4:M.FLOAT,uint32:M.UNSIGNED_INT,uint32x2:M.UNSIGNED_INT,uint32x3:M.UNSIGNED_INT,uint32x4:M.UNSIGNED_INT,sint32:M.INT,sint32x2:M.INT,sint32x3:M.INT,sint32x4:M.INT},O={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class P{constructor(){this.vaoCache=Object.create(null)}destroy(){this.vaoCache=Object.create(null)}}class Q{constructor(a){this._renderer=a,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this._managedGeometries=new A.GCManagedHash({renderer:a,type:"resource",onUnload:this.onGeometryUnload.bind(this),name:"glGeometry"})}contextChange(){let a=this.gl=this._renderer.gl;if(!this._renderer.context.supports.vertexArrayObject)throw Error("[PixiJS] Vertex Array Objects are not supported on this device");this.destroyAll(!0);let b=this._renderer.context.extensions.vertexArrayObject;b&&(a.createVertexArray=()=>b.createVertexArrayOES(),a.bindVertexArray=a=>b.bindVertexArrayOES(a),a.deleteVertexArray=a=>b.deleteVertexArrayOES(a));let c=this._renderer.context.extensions.vertexAttribDivisorANGLE;c&&(a.drawArraysInstanced=(a,b,d,e)=>{c.drawArraysInstancedANGLE(a,b,d,e)},a.drawElementsInstanced=(a,b,d,e,f)=>{c.drawElementsInstancedANGLE(a,b,d,e,f)},a.vertexAttribDivisor=(a,b)=>c.vertexAttribDivisorANGLE(a,b)),this._activeGeometry=null,this._activeVao=null}bind(a,b){let c=this.gl;this._activeGeometry=a;let d=this.getVao(a,b);this._activeVao!==d&&(this._activeVao=d,c.bindVertexArray(d)),this.updateBuffers()}resetState(){this.unbind()}updateBuffers(){let a=this._activeGeometry,b=this._renderer.buffer;for(let c=0;c<a.buffers.length;c++){let d=a.buffers[c];b.updateBuffer(d)}a._gcLastUsed=this._renderer.gc.now}checkCompatibility(a,b){let c=a.attributes,d=b._attributeData;for(let a in d)if(!c[a])throw Error(`shader and geometry incompatible, geometry missing the "${a}" attribute`)}getSignature(a,b){let c=a.attributes,d=b._attributeData,e=["g",a.uid];for(let a in c)d[a]&&e.push(a,d[a].location);return e.join("-")}getVao(a,b){return a._gpuData[this._renderer.uid]?.vaoCache[b._key]||this.initGeometryVao(a,b)}initGeometryVao(a,b,c=!0){let d=this._renderer.gl,e=this._renderer.buffer;this._renderer.shader._getProgramData(b),this.checkCompatibility(a,b);let f=this.getSignature(a,b),g=new P;a._gpuData[this._renderer.uid]=g,this._managedGeometries.add(a);let h=g.vaoCache,i=h[f];if(i)return h[b._key]=i,i;(0,I.ensureAttributes)(a,b._attributeData);let j=a.buffers;i=d.createVertexArray(),d.bindVertexArray(i);for(let a=0;a<j.length;a++){let b=j[a];e.bind(b)}return this.activateVao(a,b),h[b._key]=i,h[f]=i,d.bindVertexArray(null),i}onGeometryUnload(a,b=!1){let c=a._gpuData[this._renderer.uid];if(!c)return;let d=c.vaoCache;if(!b)for(let a in d)this._activeVao!==d[a]&&this.resetState(),this.gl.deleteVertexArray(d[a])}destroyAll(a=!1){this._managedGeometries.removeAll(a)}activateVao(a,b){let c=this._renderer.gl,d=this._renderer.buffer,e=a.attributes;a.indexBuffer&&d.bind(a.indexBuffer);let f=null;for(let a in e){let g=e[a],h=g.buffer,i=d.getGlBuffer(h),j=b._attributeData[a];if(j){f!==i&&(d.bind(h),f=i);let a=j.location;c.enableVertexAttribArray(a);let b=(0,H.getAttributeInfoFromFormat)(g.format),e=N[g.format]??N.float32;if(j.format?.substring(1,4)==="int"?c.vertexAttribIPointer(a,b.size,e,g.stride,g.offset):c.vertexAttribPointer(a,b.size,e,b.normalised,g.stride,g.offset),g.instance)if(this.hasInstance){let b=g.divisor??1;c.vertexAttribDivisor(a,b)}else throw Error("geometry error, GPU Instancing is not supported on this device")}}}draw(a,b,c,d){let{gl:e}=this._renderer,f=this._activeGeometry,g=O[a||f.topology];if(d??(d=f.instanceCount),f.indexBuffer){let a=f.indexBuffer.data.BYTES_PER_ELEMENT,h=2===a?e.UNSIGNED_SHORT:e.UNSIGNED_INT;1!==d?e.drawElementsInstanced(g,b||f.indexBuffer.data.length,h,(c||0)*a,d):e.drawElements(g,b||f.indexBuffer.data.length,h,(c||0)*a)}else 1!==d?e.drawArraysInstanced(g,c||0,b||f.getSize(),d):e.drawArrays(g,c||0,b||f.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._managedGeometries.destroy(),this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}}Q.extension={type:[g.ExtensionType.WebGLSystem],name:"geometry"};var R=a.i(54676),S=a.i(31394),T=a.i(53229);let U=new R.Geometry({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),V=class a{constructor(a){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=a}init(b={}){let{useBackBuffer:c,antialias:d}={...a.defaultOptions,...b};this.useBackBuffer=c,this._antialias=d,this._renderer.context.supports.msaa||((0,t.warn)("antialiasing, is not supported on when using the back buffer"),this._antialias=!1),this._state=v.State.for2d();let e=new T.GlProgram({vertex:`
                attribute vec2 aPosition;
                out vec2 vUv;

                void main() {
                    gl_Position = vec4(aPosition, 0.0, 1.0);

                    vUv = (aPosition + 1.0) / 2.0;

                    // flip dem UVs
                    vUv.y = 1.0 - vUv.y;
                }`,fragment:`
                in vec2 vUv;
                out vec4 finalColor;

                uniform sampler2D uTexture;

                void main() {
                    finalColor = texture(uTexture, vUv);
                }`,name:"big-triangle"});this._bigTriangleShader=new o.Shader({glProgram:e,resources:{uTexture:s.Texture.WHITE.source}})}renderStart(a){let b=this._renderer.renderTarget.getRenderTarget(a.target);if(this._useBackBufferThisRender=this.useBackBuffer&&!!b.isRoot,this._useBackBufferThisRender){let b=this._renderer.renderTarget.getRenderTarget(a.target);this._targetTexture=b.colorTexture,a.target=this._getBackBufferTexture(b.colorTexture)}}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){let a=this._renderer;a.renderTarget.finishRenderPass(),this._useBackBufferThisRender&&(a.renderTarget.bind(this._targetTexture,!1),this._bigTriangleShader.resources.uTexture=this._backBufferTexture.source,a.encoder.draw({geometry:U,shader:this._bigTriangleShader,state:this._state}))}_getBackBufferTexture(a){return this._backBufferTexture=this._backBufferTexture||new s.Texture({source:new S.TextureSource({width:a.width,height:a.height,resolution:a._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(a.width,a.height,a._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};V.extension={type:[g.ExtensionType.WebGLSystem],name:"backBuffer",priority:1},V.defaultOptions={useBackBuffer:!1};class W{constructor(a){this._colorMaskCache=15,this._renderer=a}setMask(a){this._colorMaskCache!==a&&(this._colorMaskCache=a,this._renderer.gl.colorMask(!!(8&a),!!(4&a),!!(2&a),!!(1&a)))}}W.extension={type:[g.ExtensionType.WebGLSystem],name:"colorMask"};class X{constructor(a){this.commandFinished=Promise.resolve(),this._renderer=a}setGeometry(a,b){this._renderer.geometry.bind(a,b.glProgram)}finishRenderPass(){}draw(a){let b=this._renderer,{geometry:c,shader:d,state:e,skipSync:f,topology:g,size:h,start:i,instanceCount:j}=a;b.shader.bind(d,f),b.geometry.bind(c,b.shader._activeProgram),e&&b.state.set(e),b.geometry.draw(g,h,i,j??c.instanceCount)}destroy(){this._renderer=null}}X.extension={type:[g.ExtensionType.WebGLSystem],name:"encoder"};var Y=a.i(26254);class Z{constructor(a){this._renderer=a}contextChange(){let a=this._renderer.gl;this.maxTextures=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),this.maxBatchableTextures=(0,Y.checkMaxIfStatementsInShader)(this.maxTextures,a);let b=2===this._renderer.context.webGLVersion;this.maxUniformBindings=b?a.getParameter(a.MAX_UNIFORM_BUFFER_BINDINGS):0}destroy(){}}Z.extension={type:[g.ExtensionType.WebGLSystem],name:"limits"};var $=a.i(29477),_=a.i(35990);class aa{constructor(a){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:_.STENCIL_MODES.NONE},this._renderTargetStencilState=Object.create(null),a.renderTarget.onRenderTargetChange.add(this)}contextChange(a){this._gl=a,this._comparisonFuncMapping={always:a.ALWAYS,never:a.NEVER,equal:a.EQUAL,"not-equal":a.NOTEQUAL,less:a.LESS,"less-equal":a.LEQUAL,greater:a.GREATER,"greater-equal":a.GEQUAL},this._stencilOpsMapping={keep:a.KEEP,zero:a.ZERO,replace:a.REPLACE,invert:a.INVERT,"increment-clamp":a.INCR,"decrement-clamp":a.DECR,"increment-wrap":a.INCR_WRAP,"decrement-wrap":a.DECR_WRAP},this.resetState()}onRenderTargetChange(a){if(this._activeRenderTarget===a)return;this._activeRenderTarget=a;let b=this._renderTargetStencilState[a.uid];b||(b=this._renderTargetStencilState[a.uid]={stencilMode:_.STENCIL_MODES.DISABLED,stencilReference:0}),this.setStencilMode(b.stencilMode,b.stencilReference)}resetState(){this._stencilCache.enabled=!1,this._stencilCache.stencilMode=_.STENCIL_MODES.NONE,this._stencilCache.stencilReference=0}setStencilMode(a,b){let c=this._renderTargetStencilState[this._activeRenderTarget.uid],d=this._gl,e=$.GpuStencilModesToPixi[a],f=this._stencilCache;if(c.stencilMode=a,c.stencilReference=b,a===_.STENCIL_MODES.DISABLED){this._stencilCache.enabled&&(this._stencilCache.enabled=!1,d.disable(d.STENCIL_TEST));return}this._stencilCache.enabled||(this._stencilCache.enabled=!0,d.enable(d.STENCIL_TEST)),(a!==f.stencilMode||f.stencilReference!==b)&&(f.stencilMode=a,f.stencilReference=b,d.stencilFunc(this._comparisonFuncMapping[e.stencilBack.compare],b,255),d.stencilOp(d.KEEP,d.KEEP,this._stencilOpsMapping[e.stencilBack.passOp]))}}aa.extension={type:[g.ExtensionType.WebGLSystem],name:"stencil"};var ab=a.i(55164);let ac={f32:4,i32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"vec2<i32>":8,"vec3<i32>":12,"vec4<i32>":16,"mat2x2<f32>":32,"mat3x3<f32>":48,"mat4x4<f32>":64};function ad(a){let b=a.map(a=>({data:a,offset:0,size:0})),c=0,d=0;for(let a=0;a<b.length;a++){let e=b[a];if(!(c=ac[e.data.type]))throw Error(`Unknown type ${e.data.type}`);e.data.size>1&&(c=Math.max(c,16)*e.data.size);let f=12===c?16:c;e.size=c;let g=d%16;g>0&&16-g<f?d+=(16-g)%16:d+=(c-g%c)%c,e.offset=d,d+=c}return{uboElements:b,size:d=16*Math.ceil(d/16)}}var ae=a.i(1527),af=a.i(37630);function ag(a,b){let c=Math.max(ac[a.data.type]/16,1),d=a.data.value.length/a.data.size,e=(4-d%4)%4,f=a.data.type.indexOf("i32")>=0?"dataInt32":"data";return`
        v = uv.${a.data.name};
        offset += ${b};

        arrayOffset = offset;

        t = 0;

        for(var i=0; i < ${a.data.size*c}; i++)
        {
            for(var j = 0; j < ${d}; j++)
            {
                ${f}[arrayOffset++] = v[t++];
            }
            ${0!==e?`arrayOffset += ${e};`:""}
        }
    `}function ah(a){return(0,ae.createUboSyncFunction)(a,"uboStd40",ag,af.uboSyncFunctionsSTD40)}class ai extends ab.UboSystem{constructor(){super({createUboElements:ad,generateUboSync:ah})}}ai.extension={type:[g.ExtensionType.WebGLSystem],name:"ubo"};var aj=a.i(31741),ak=a.i(31023),al=a.i(39238),am=a.i(10091);class an{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}class ao{constructor(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new ak.Rectangle}init(a,b){this._renderer=a,this._renderTargetSystem=b,a.runners.contextChange.add(this)}contextChange(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new ak.Rectangle;let a=this._renderer.gl;this._drawBuffersCache=[];for(let b=1;b<=16;b++)this._drawBuffersCache[b]=Array.from({length:b},(b,c)=>a.COLOR_ATTACHMENT0+c)}copyToTexture(a,b,c,d,e){let f=this._renderTargetSystem,g=this._renderer,h=f.getGpuRenderTarget(a),i=g.gl;return this.finishRenderPass(a),i.bindFramebuffer(i.FRAMEBUFFER,h.resolveTargetFramebuffer),g.texture.bind(b,0),i.copyTexSubImage2D(i.TEXTURE_2D,0,e.x,e.y,c.x,c.y,d.width,d.height),b}startRenderPass(a,b=!0,c,d){let e=this._renderTargetSystem,f=a.colorTexture,g=e.getGpuRenderTarget(a),h=d.y;a.isRoot&&(h=f.pixelHeight-d.height-d.y),a.colorTextures.forEach(a=>{this._renderer.texture.unbind(a)});let i=this._renderer.gl;i.bindFramebuffer(i.FRAMEBUFFER,g.framebuffer),a.colorTextures.length>1&&this._setDrawBuffers(a,i);let j=this._viewPortCache;(j.x!==d.x||j.y!==h||j.width!==d.width||j.height!==d.height)&&(j.x=d.x,j.y=h,j.width=d.width,j.height=d.height,i.viewport(d.x,h,d.width,d.height)),!g.depthStencilRenderBuffer&&(a.stencil||a.depth)&&this._initStencil(g),this.clear(a,b,c)}finishRenderPass(a){let b=this._renderTargetSystem.getGpuRenderTarget(a);if(!b.msaa)return;let c=this._renderer.gl;c.bindFramebuffer(c.FRAMEBUFFER,b.resolveTargetFramebuffer),c.bindFramebuffer(c.READ_FRAMEBUFFER,b.framebuffer),c.blitFramebuffer(0,0,b.width,b.height,0,0,b.width,b.height,c.COLOR_BUFFER_BIT,c.NEAREST),c.bindFramebuffer(c.FRAMEBUFFER,b.framebuffer)}initGpuRenderTarget(a){let b=this._renderer.gl,c=new an;return a.colorTexture instanceof al.CanvasSource?(this._renderer.context.ensureCanvasSize(a.colorTexture.resource),c.framebuffer=null):(this._initColor(a,c),b.bindFramebuffer(b.FRAMEBUFFER,null)),c}destroyGpuRenderTarget(a){let b=this._renderer.gl;a.framebuffer&&(b.deleteFramebuffer(a.framebuffer),a.framebuffer=null),a.resolveTargetFramebuffer&&(b.deleteFramebuffer(a.resolveTargetFramebuffer),a.resolveTargetFramebuffer=null),a.depthStencilRenderBuffer&&(b.deleteRenderbuffer(a.depthStencilRenderBuffer),a.depthStencilRenderBuffer=null),a.msaaRenderBuffer.forEach(a=>{b.deleteRenderbuffer(a)}),a.msaaRenderBuffer=null}clear(a,b,c){if(!b)return;let d=this._renderTargetSystem;"boolean"==typeof b&&(b=b?am.CLEAR.ALL:am.CLEAR.NONE);let e=this._renderer.gl;if(b&am.CLEAR.COLOR){c??(c=d.defaultClearColor);let a=this._clearColorCache,b=c;(a[0]!==b[0]||a[1]!==b[1]||a[2]!==b[2]||a[3]!==b[3])&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],e.clearColor(b[0],b[1],b[2],b[3]))}e.clear(b)}resizeGpuRenderTarget(a){if(a.isRoot)return;let b=this._renderTargetSystem.getGpuRenderTarget(a);this._resizeColor(a,b),(a.stencil||a.depth)&&this._resizeStencil(b)}_initColor(a,b){let c=this._renderer,d=c.gl,e=d.createFramebuffer();if(b.resolveTargetFramebuffer=e,d.bindFramebuffer(d.FRAMEBUFFER,e),b.width=a.colorTexture.source.pixelWidth,b.height=a.colorTexture.source.pixelHeight,a.colorTextures.forEach((a,e)=>{let f=a.source;f.antialias&&(c.context.supports.msaa?b.msaa=!0:(0,t.warn)("[RenderTexture] Antialiasing on textures is not supported in WebGL1")),c.texture.bindSource(f,0);let g=c.texture.getGlSource(f).texture;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0+e,3553,g,0)}),b.msaa){let c=d.createFramebuffer();b.framebuffer=c,d.bindFramebuffer(d.FRAMEBUFFER,c),a.colorTextures.forEach((a,c)=>{let e=d.createRenderbuffer();b.msaaRenderBuffer[c]=e})}else b.framebuffer=e;this._resizeColor(a,b)}_resizeColor(a,b){let c=a.colorTexture.source;if(b.width=c.pixelWidth,b.height=c.pixelHeight,a.colorTextures.forEach((a,b)=>{0!==b&&a.source.resize(c.width,c.height,c._resolution)}),b.msaa){let c=this._renderer,d=c.gl,e=b.framebuffer;d.bindFramebuffer(d.FRAMEBUFFER,e),a.colorTextures.forEach((a,e)=>{let f=a.source;c.texture.bindSource(f,0);let g=c.texture.getGlSource(f).internalFormat,h=b.msaaRenderBuffer[e];d.bindRenderbuffer(d.RENDERBUFFER,h),d.renderbufferStorageMultisample(d.RENDERBUFFER,4,g,f.pixelWidth,f.pixelHeight),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0+e,d.RENDERBUFFER,h)})}}_initStencil(a){if(null===a.framebuffer)return;let b=this._renderer.gl,c=b.createRenderbuffer();a.depthStencilRenderBuffer=c,b.bindRenderbuffer(b.RENDERBUFFER,c),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,c),this._resizeStencil(a)}_resizeStencil(a){let b=this._renderer.gl;b.bindRenderbuffer(b.RENDERBUFFER,a.depthStencilRenderBuffer),a.msaa?b.renderbufferStorageMultisample(b.RENDERBUFFER,4,b.DEPTH24_STENCIL8,a.width,a.height):b.renderbufferStorage(b.RENDERBUFFER,2===this._renderer.context.webGLVersion?b.DEPTH24_STENCIL8:b.DEPTH_STENCIL,a.width,a.height)}prerender(a){let b=a.colorTexture.resource;this._renderer.context.multiView&&al.CanvasSource.test(b)&&this._renderer.context.ensureCanvasSize(b)}postrender(a){if(this._renderer.context.multiView&&al.CanvasSource.test(a.colorTexture.resource)){let b=this._renderer.context.canvas,c=a.colorTexture;c.context2D.drawImage(b,0,c.pixelHeight-b.height)}}_setDrawBuffers(a,b){let c=a.colorTextures.length,d=this._drawBuffersCache[c];if(1===this._renderer.context.webGLVersion){let a=this._renderer.context.extensions.drawBuffers;a?a.drawBuffersWEBGL(d):(0,t.warn)("[RenderTexture] This WebGL1 context does not support rendering to multiple targets")}else b.drawBuffers(d)}}class ap extends aj.RenderTargetSystem{constructor(a){super(a),this.adaptor=new ao,this.adaptor.init(a,this)}}ap.extension={type:[g.ExtensionType.WebGLSystem],name:"renderTarget"};var aq=a.i(10961);class ar{constructor(a,b){this.program=a,this.uniformData=b,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function as(a,b,c){let d=a.createShader(b);return a.shaderSource(d,c),a.compileShader(d),d}function at(a){let b=Array(a);for(let a=0;a<b.length;a++)b[a]=!1;return b}function au(a,b){switch(a){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*b);case"vec3":return new Float32Array(3*b);case"vec4":return new Float32Array(4*b);case"ivec2":return new Int32Array(2*b);case"ivec3":return new Int32Array(3*b);case"ivec4":return new Int32Array(4*b);case"uvec2":return new Uint32Array(2*b);case"uvec3":return new Uint32Array(3*b);case"uvec4":return new Uint32Array(4*b);case"bool":return!1;case"bvec2":return at(2*b);case"bvec3":return at(3*b);case"bvec4":return at(4*b);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}let av=null,aw={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},ax={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"};function ay(a,b){if(!av){let b=Object.keys(aw);av={};for(let c=0;c<b.length;++c){let d=b[c];av[a[d]]=aw[d]}}return av[b]}function az(a,b){let c=a.getShaderSource(b).split("\n").map((a,b)=>`${b}: ${a}`),d=a.getShaderInfoLog(b),e=d.split("\n"),f={},g=e.map(a=>parseFloat(a.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(a=>!!a&&!f[a]&&(f[a]=!0,!0)),h=[""];g.forEach(a=>{c[a-1]=`%c${c[a-1]}%c`,h.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});let i=c.join("\n");h[0]=i,console.error(d),console.groupCollapsed("click to view full shader code"),console.warn(...h),console.groupEnd()}let aA={textureCount:0,blockIndex:0};class aB{constructor(a){this._activeProgram=null,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._renderer=a}contextChange(a){this._gl=a,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._activeProgram=null}bind(a,b){if(this._setProgram(a.glProgram),b)return;aA.textureCount=0,aA.blockIndex=0;let c=this._shaderSyncFunctions[a.glProgram._key];c||(c=this._shaderSyncFunctions[a.glProgram._key]=this._generateShaderSync(a,this)),this._renderer.buffer.nextBindBase(!!a.glProgram.transformFeedbackVaryings),c(this._renderer,a,aA)}updateUniformGroup(a){this._renderer.uniformGroup.updateUniformGroup(a,this._activeProgram,aA)}bindUniformBlock(a,b,c=0){let d=this._renderer.buffer,e=this._getProgramData(this._activeProgram),f=a._bufferResource;f||this._renderer.ubo.updateUniformGroup(a);let g=a.buffer,h=d.updateBuffer(g),i=d.freeLocationForBufferBase(h);if(f){let{offset:b,size:c}=a;0===b&&c===g.data.byteLength?d.bindBufferBase(h,i):d.bindBufferRange(h,i,b)}else d.getLastBindBaseLocation(h)!==i&&d.bindBufferBase(h,i);let j=this._activeProgram._uniformBlockData[b].index;e.uniformBlockBindings[c]!==i&&(e.uniformBlockBindings[c]=i,this._renderer.gl.uniformBlockBinding(e.program,j,i))}_setProgram(a){if(this._activeProgram===a)return;this._activeProgram=a;let b=this._getProgramData(a);this._gl.useProgram(b.program)}_getProgramData(a){return this._programDataHash[a._key]||this._createProgramData(a)}_createProgramData(a){let b=a._key;return this._programDataHash[b]=function(a,b){let c=as(a,a.VERTEX_SHADER,b.vertex),d=as(a,a.FRAGMENT_SHADER,b.fragment),e=a.createProgram();a.attachShader(e,c),a.attachShader(e,d);let f=b.transformFeedbackVaryings;f&&("function"!=typeof a.transformFeedbackVaryings?(0,t.warn)("TransformFeedback is not supported but TransformFeedbackVaryings are given."):a.transformFeedbackVaryings(e,f.names,"separate"===f.bufferMode?a.SEPARATE_ATTRIBS:a.INTERLEAVED_ATTRIBS)),a.linkProgram(e),!a.getProgramParameter(e,a.LINK_STATUS)&&(a.getProgramParameter(e,a.LINK_STATUS)||(a.getShaderParameter(c,a.COMPILE_STATUS)||az(a,c),a.getShaderParameter(d,a.COMPILE_STATUS)||az(a,d),console.error("PixiJS Error: Could not initialize shader."),""!==a.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",a.getProgramInfoLog(e)))),b._attributeData=function(a,b,c=!1){let d={},e=b.getProgramParameter(a,b.ACTIVE_ATTRIBUTES);for(let c=0;c<e;c++){let e=b.getActiveAttrib(a,c);if(e.name.startsWith("gl_"))continue;let f=ax[ay(b,e.type)]||"float32";d[e.name]={location:0,format:f,stride:(0,H.getAttributeInfoFromFormat)(f).stride,offset:0,instance:!1,start:0}}let f=Object.keys(d);if(c){f.sort((a,b)=>a>b?1:-1);for(let c=0;c<f.length;c++)d[f[c]].location=c,b.bindAttribLocation(a,c,f[c]);b.linkProgram(a)}else for(let c=0;c<f.length;c++)d[f[c]].location=b.getAttribLocation(a,f[c]);return d}(e,a,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(b.vertex)),b._uniformData=function(a,b){let c={},d=b.getProgramParameter(a,b.ACTIVE_UNIFORMS);for(let e=0;e<d;e++){let d=b.getActiveUniform(a,e),f=d.name.replace(/\[.*?\]$/,""),g=!!d.name.match(/\[.*?\]$/),h=ay(b,d.type);c[f]={name:f,index:e,type:h,size:d.size,isArray:g,value:au(h,d.size)}}return c}(e,a),b._uniformBlockData=function(a,b){if(!b.ACTIVE_UNIFORM_BLOCKS)return{};let c={},d=b.getProgramParameter(a,b.ACTIVE_UNIFORM_BLOCKS);for(let e=0;e<d;e++){let d=b.getActiveUniformBlockName(a,e),f=b.getUniformBlockIndex(a,d),g=b.getActiveUniformBlockParameter(a,e,b.UNIFORM_BLOCK_DATA_SIZE);c[d]={name:d,index:f,size:g}}return c}(e,a),a.deleteShader(c),a.deleteShader(d);let g={};for(let c in b._uniformData){let d=b._uniformData[c];g[c]={location:a.getUniformLocation(e,c),value:au(d.type,d.size)}}return new ar(e,g)}(this._gl,a),this._programDataHash[b]}destroy(){for(let a of Object.keys(this._programDataHash))this._programDataHash[a].destroy();this._programDataHash=null,this._shaderSyncFunctions=null,this._activeProgram=null,this._renderer=null,this._gl=null}_generateShaderSync(a,b){return function(a,b){let c=[],d=[`
        var g = s.groups;
        var sS = r.shader;
        var p = s.glProgram;
        var ugS = r.uniformGroup;
        var resources;
    `],e=!1,f=0,g=b._getProgramData(a.glProgram);for(let h in a.groups){let i=a.groups[h];for(let j in c.push(`
            resources = g[${h}].resources;
        `),i.resources){let k=i.resources[j];if(k instanceof p.UniformGroup)if(k.ubo){let b=a._uniformBindMap[h][Number(j)];c.push(`
                        sS.bindUniformBlock(
                            resources[${j}],
                            '${b}',
                            ${a.glProgram._uniformBlockData[b].index}
                        );
                    `)}else c.push(`
                        ugS.updateUniformGroup(resources[${j}], p, sD);
                    `);else if(k instanceof aq.BufferResource){let b=a._uniformBindMap[h][Number(j)];c.push(`
                    sS.bindUniformBlock(
                        resources[${j}],
                        '${b}',
                        ${a.glProgram._uniformBlockData[b].index}
                    );
                `)}else if(k instanceof S.TextureSource){let i=a._uniformBindMap[h][j],k=g.uniformData[i];k&&(e||(e=!0,d.push(`
                        var tS = r.texture;
                        `)),b._gl.uniform1i(k.location,f),c.push(`
                        tS.bind(resources[${j}], ${f});
                    `),f++)}}}return Function("r","s","sD",[...d,...c].join("\n"))}(a,b)}resetState(){this._activeProgram=null}}aB.extension={type:[g.ExtensionType.WebGLSystem],name:"shader"};var aC=a.i(51581);let aD={f32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1f(location, v);
        }`,"vec2<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2f(location, v[0], v[1]);
        }`,"vec3<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3f(location, v[0], v[1], v[2]);
        }`,"vec4<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4f(location, v[0], v[1], v[2], v[3]);
        }`,i32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,u32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1ui(location, v);
        }`,"vec2<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2ui(location, v[0], v[1]);
        }`,"vec3<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3ui(location, v[0], v[1], v[2]);
        }`,"vec4<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
        }`,bool:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,"mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},aE={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"};class aF{constructor(a){this._cache={},this._uniformGroupSyncHash={},this._renderer=a,this.gl=null,this._cache={}}contextChange(a){this.gl=a}updateUniformGroup(a,b,c){let d=this._renderer.shader._getProgramData(b);a.isStatic&&a._dirtyId===d.uniformDirtyGroups[a.uid]||(d.uniformDirtyGroups[a.uid]=a._dirtyId,this._getUniformSyncFunction(a,b)(d.uniformData,a.uniforms,this._renderer,c))}_getUniformSyncFunction(a,b){return this._uniformGroupSyncHash[a._signature]?.[b._key]||this._createUniformSyncFunction(a,b)}_createUniformSyncFunction(a,b){let c=this._uniformGroupSyncHash[a._signature]||(this._uniformGroupSyncHash[a._signature]={}),d=this._getSignature(a,b._uniformData,"u");return this._cache[d]||(this._cache[d]=this._generateUniformsSync(a,b._uniformData)),c[b._key]=this._cache[d],c[b._key]}_generateUniformsSync(a,b){return function(a,b){let c=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
        var name = null;
    `];for(let d in a.uniforms){if(!b[d]){a.uniforms[d]instanceof p.UniformGroup?a.uniforms[d].ubo?c.push(`
                        renderer.shader.bindUniformBlock(uv.${d}, "${d}");
                    `):c.push(`
                        renderer.shader.updateUniformGroup(uv.${d});
                    `):a.uniforms[d]instanceof aq.BufferResource&&c.push(`
                        renderer.shader.bindBufferResource(uv.${d}, "${d}");
                    `);continue}let e=a.uniformStructures[d],f=!1;for(let a=0;a<aC.uniformParsers.length;a++){let b=aC.uniformParsers[a];if(e.type===b.type&&b.test(e)){c.push(`name = "${d}";`,aC.uniformParsers[a].uniform),f=!0;break}}if(!f){let a=(1===e.size?aD:aE)[e.type].replace("location",`ud["${d}"].location`);c.push(`
            cu = ud["${d}"];
            cv = cu.value;
            v = uv["${d}"];
            ${a};`)}}return Function("ud","uv","renderer","syncData",c.join("\n"))}(a,b)}_getSignature(a,b,c){let d=a.uniforms,e=[`${c}-`];for(let a in d)e.push(a),b[a]&&e.push(b[a].type);return e.join("-")}destroy(){this._renderer=null,this._cache=null}}aF.extension={type:[g.ExtensionType.WebGLSystem],name:"uniformGroup"};let aG=class a{constructor(a){this._invertFrontFace=!1,this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=v.State.for2d(),a.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(a){this._invertFrontFace=!a.isRoot,this._cullFace?this.setFrontFace(this._frontFace):this._frontFaceDirty=!0}contextChange(a){this.gl=a,this.blendModesMap=function(a){let b={};if(b.normal=[a.ONE,a.ONE_MINUS_SRC_ALPHA],b.add=[a.ONE,a.ONE],b.multiply=[a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA],b.screen=[a.ONE,a.ONE_MINUS_SRC_COLOR,a.ONE,a.ONE_MINUS_SRC_ALPHA],b.none=[0,0],b["normal-npm"]=[a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA],b["add-npm"]=[a.SRC_ALPHA,a.ONE,a.ONE,a.ONE],b["screen-npm"]=[a.SRC_ALPHA,a.ONE_MINUS_SRC_COLOR,a.ONE,a.ONE_MINUS_SRC_ALPHA],b.erase=[a.ZERO,a.ONE_MINUS_SRC_ALPHA],a instanceof F.DOMAdapter.get().getWebGLRenderingContext()){let c=a.getExtension("EXT_blend_minmax");c&&(b.min=[a.ONE,a.ONE,a.ONE,a.ONE,c.MIN_EXT,c.MIN_EXT],b.max=[a.ONE,a.ONE,a.ONE,a.ONE,c.MAX_EXT,c.MAX_EXT])}else b.min=[a.ONE,a.ONE,a.ONE,a.ONE,a.MIN,a.MIN],b.max=[a.ONE,a.ONE,a.ONE,a.ONE,a.MAX,a.MAX];return b}(a),this.resetState()}set(a){if(a||(a=this.defaultState),this.stateId!==a.data){let b=this.stateId^a.data,c=0;for(;b;)1&b&&this.map[c].call(this,!!(a.data&1<<c)),b>>=1,c++;this.stateId=a.data}for(let b=0;b<this.checks.length;b++)this.checks[b](this,a)}forceState(a){a||(a=this.defaultState);for(let b=0;b<this.map.length;b++)this.map[b].call(this,!!(a.data&1<<b));for(let b=0;b<this.checks.length;b++)this.checks[b](this,a);this.stateId=a.data}setBlend(b){this._updateCheck(a._checkBlendMode,b),this.gl[b?"enable":"disable"](this.gl.BLEND)}setOffset(b){this._updateCheck(a._checkPolygonOffset,b),this.gl[b?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(a){this.gl[a?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(a){this.gl.depthMask(a)}setCullFace(a){this._cullFace=a,this.gl[a?"enable":"disable"](this.gl.CULL_FACE),this._cullFace&&this._frontFaceDirty&&this.setFrontFace(this._frontFace)}setFrontFace(a){this._frontFace=a,this._frontFaceDirty=!1;let b=this._invertFrontFace?!a:a;this._glFrontFace!==b&&(this._glFrontFace=b,this.gl.frontFace(this.gl[b?"CW":"CCW"]))}setBlendMode(a){if(this.blendModesMap[a]||(a="normal"),a===this.blendMode)return;this.blendMode=a;let b=this.blendModesMap[a],c=this.gl;2===b.length?c.blendFunc(b[0],b[1]):c.blendFuncSeparate(b[0],b[1],b[2],b[3]),6===b.length?(this._blendEq=!0,c.blendEquationSeparate(b[4],b[5])):this._blendEq&&(this._blendEq=!1,c.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD))}setPolygonOffset(a,b){this.gl.polygonOffset(a,b)}resetState(){this._glFrontFace=!1,this._frontFace=!1,this._cullFace=!1,this._frontFaceDirty=!1,this._invertFrontFace=!1,this.gl.frontFace(this.gl.CCW),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(a,b){let c=this.checks.indexOf(a);b&&-1===c?this.checks.push(a):b||-1===c||this.checks.splice(c,1)}static _checkBlendMode(a,b){a.setBlendMode(b.blendMode)}static _checkPolygonOffset(a,b){a.setPolygonOffset(1,b.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};aG.extension={type:[g.ExtensionType.WebGLSystem],name:"state"};class aH{constructor(a){this.target=K.TEXTURE_2D,this.texture=a,this.width=-1,this.height=-1,this.type=M.UNSIGNED_BYTE,this.internalFormat=J.RGBA,this.format=J.RGBA,this.samplerType=0}destroy(){}}let aI={id:"buffer",upload(a,b,c){b.width===a.width||b.height===a.height?c.texSubImage2D(c.TEXTURE_2D,0,0,0,a.width,a.height,b.format,b.type,a.resource):c.texImage2D(b.target,0,b.internalFormat,a.width,a.height,0,b.format,b.type,a.resource),b.width=a.width,b.height=a.height}},aJ={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},aK={id:"compressed",upload(a,b,c){c.pixelStorei(c.UNPACK_ALIGNMENT,4);let d=a.pixelWidth,e=a.pixelHeight,f=!!aJ[a.format];for(let g=0;g<a.resource.length;g++){let h=a.resource[g];f?c.compressedTexImage2D(c.TEXTURE_2D,g,b.internalFormat,d,e,0,h):c.texImage2D(c.TEXTURE_2D,g,b.internalFormat,d,e,0,b.format,b.type,h),d=Math.max(d>>1,1),e=Math.max(e>>1,1)}}},aL={id:"image",upload(a,b,c,d){let e=b.width,f=b.height,g=a.pixelWidth,h=a.pixelHeight,i=a.resourceWidth,j=a.resourceHeight;i<g||j<h?((e!==g||f!==h)&&c.texImage2D(b.target,0,b.internalFormat,g,h,0,b.format,b.type,null),2===d?c.texSubImage2D(c.TEXTURE_2D,0,0,0,i,j,b.format,b.type,a.resource):c.texSubImage2D(c.TEXTURE_2D,0,0,0,b.format,b.type,a.resource)):e===g&&f===h?c.texSubImage2D(c.TEXTURE_2D,0,0,0,b.format,b.type,a.resource):2===d?c.texImage2D(b.target,0,b.internalFormat,g,h,0,b.format,b.type,a.resource):c.texImage2D(b.target,0,b.internalFormat,b.format,b.type,a.resource),b.width=g,b.height=h}},aM={id:"video",upload(a,b,c,d){a.isValid?aL.upload(a,b,c,d):c.texImage2D(b.target,0,b.internalFormat,1,1,0,b.format,b.type,null)}},aN={linear:9729,nearest:9728},aO={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},aP={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},aQ={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function aR(a,b,c,d,e,f,g,h){if(!h||"repeat"!==a.addressModeU||"repeat"!==a.addressModeV||"repeat"!==a.addressModeW){let c=aP[g?"clamp-to-edge":a.addressModeU],d=aP[g?"clamp-to-edge":a.addressModeV],h=aP[g?"clamp-to-edge":a.addressModeW];b[e](f,b.TEXTURE_WRAP_S,c),b[e](f,b.TEXTURE_WRAP_T,d),b.TEXTURE_WRAP_R&&b[e](f,b.TEXTURE_WRAP_R,h)}if(h&&"linear"===a.magFilter||b[e](f,b.TEXTURE_MAG_FILTER,aN[a.magFilter]),c){if(!h||"linear"!==a.mipmapFilter){let c=aO[a.minFilter][a.mipmapFilter];b[e](f,b.TEXTURE_MIN_FILTER,c)}}else b[e](f,b.TEXTURE_MIN_FILTER,aN[a.minFilter]);if(d&&a.maxAnisotropy>1){let c=Math.min(a.maxAnisotropy,b.getParameter(d.MAX_TEXTURE_MAX_ANISOTROPY_EXT));b[e](f,d.TEXTURE_MAX_ANISOTROPY_EXT,c)}a.compare&&b[e](f,b.TEXTURE_COMPARE_FUNC,aQ[a.compare])}class aS{constructor(a){this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:aL,buffer:aI,video:aM,compressed:aK},this._premultiplyAlpha=!1,this._useSeparateSamplers=!1,this._renderer=a,this._managedTextures=new A.GCManagedHash({renderer:a,type:"resource",onUnload:this.onSourceUnload.bind(this),name:"glTexture"})}get managedTextures(){return Object.values(this._managedTextures.items)}contextChange(a){if(this._gl=a,!this._mapFormatToInternalFormat){var b;let c,d;this._mapFormatToInternalFormat=(b=this._renderer.context.extensions,c={},d=a.RGBA,a instanceof F.DOMAdapter.get().getWebGLRenderingContext()?b.srgb&&(c={"rgba8unorm-srgb":b.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":b.srgb.SRGB8_ALPHA8_EXT}):(c={"rgba8unorm-srgb":a.SRGB8_ALPHA8,"bgra8unorm-srgb":a.SRGB8_ALPHA8},d=a.RGBA8),{r8unorm:a.R8,r8snorm:a.R8_SNORM,r8uint:a.R8UI,r8sint:a.R8I,r16uint:a.R16UI,r16sint:a.R16I,r16float:a.R16F,rg8unorm:a.RG8,rg8snorm:a.RG8_SNORM,rg8uint:a.RG8UI,rg8sint:a.RG8I,r32uint:a.R32UI,r32sint:a.R32I,r32float:a.R32F,rg16uint:a.RG16UI,rg16sint:a.RG16I,rg16float:a.RG16F,rgba8unorm:a.RGBA,...c,rgba8snorm:a.RGBA8_SNORM,rgba8uint:a.RGBA8UI,rgba8sint:a.RGBA8I,bgra8unorm:d,rgb9e5ufloat:a.RGB9_E5,rgb10a2unorm:a.RGB10_A2,rg11b10ufloat:a.R11F_G11F_B10F,rg32uint:a.RG32UI,rg32sint:a.RG32I,rg32float:a.RG32F,rgba16uint:a.RGBA16UI,rgba16sint:a.RGBA16I,rgba16float:a.RGBA16F,rgba32uint:a.RGBA32UI,rgba32sint:a.RGBA32I,rgba32float:a.RGBA32F,stencil8:a.STENCIL_INDEX8,depth16unorm:a.DEPTH_COMPONENT16,depth24plus:a.DEPTH_COMPONENT24,"depth24plus-stencil8":a.DEPTH24_STENCIL8,depth32float:a.DEPTH_COMPONENT32F,"depth32float-stencil8":a.DEPTH32F_STENCIL8,...b.s3tc?{"bc1-rgba-unorm":b.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":b.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":b.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...b.s3tc_sRGB?{"bc1-rgba-unorm-srgb":b.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":b.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":b.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...b.rgtc?{"bc4-r-unorm":b.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":b.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":b.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":b.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{},...b.bptc?{"bc6h-rgb-float":b.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":b.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":b.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":b.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...b.etc?{"etc2-rgb8unorm":b.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":b.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":b.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":b.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":b.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":b.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":b.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":b.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...b.astc?{"astc-4x4-unorm":b.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":b.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":b.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":b.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":b.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":b.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":b.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":b.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":b.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":b.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":b.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":b.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":b.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":b.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":b.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}),this._mapFormatToType={r8unorm:a.UNSIGNED_BYTE,r8snorm:a.BYTE,r8uint:a.UNSIGNED_BYTE,r8sint:a.BYTE,r16uint:a.UNSIGNED_SHORT,r16sint:a.SHORT,r16float:a.HALF_FLOAT,rg8unorm:a.UNSIGNED_BYTE,rg8snorm:a.BYTE,rg8uint:a.UNSIGNED_BYTE,rg8sint:a.BYTE,r32uint:a.UNSIGNED_INT,r32sint:a.INT,r32float:a.FLOAT,rg16uint:a.UNSIGNED_SHORT,rg16sint:a.SHORT,rg16float:a.HALF_FLOAT,rgba8unorm:a.UNSIGNED_BYTE,"rgba8unorm-srgb":a.UNSIGNED_BYTE,rgba8snorm:a.BYTE,rgba8uint:a.UNSIGNED_BYTE,rgba8sint:a.BYTE,bgra8unorm:a.UNSIGNED_BYTE,"bgra8unorm-srgb":a.UNSIGNED_BYTE,rgb9e5ufloat:a.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:a.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:a.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:a.UNSIGNED_INT,rg32sint:a.INT,rg32float:a.FLOAT,rgba16uint:a.UNSIGNED_SHORT,rgba16sint:a.SHORT,rgba16float:a.HALF_FLOAT,rgba32uint:a.UNSIGNED_INT,rgba32sint:a.INT,rgba32float:a.FLOAT,stencil8:a.UNSIGNED_BYTE,depth16unorm:a.UNSIGNED_SHORT,depth24plus:a.UNSIGNED_INT,"depth24plus-stencil8":a.UNSIGNED_INT_24_8,depth32float:a.FLOAT,"depth32float-stencil8":a.FLOAT_32_UNSIGNED_INT_24_8_REV},this._mapFormatToFormat={r8unorm:a.RED,r8snorm:a.RED,r8uint:a.RED,r8sint:a.RED,r16uint:a.RED,r16sint:a.RED,r16float:a.RED,rg8unorm:a.RG,rg8snorm:a.RG,rg8uint:a.RG,rg8sint:a.RG,r32uint:a.RED,r32sint:a.RED,r32float:a.RED,rg16uint:a.RG,rg16sint:a.RG,rg16float:a.RG,rgba8unorm:a.RGBA,"rgba8unorm-srgb":a.RGBA,rgba8snorm:a.RGBA,rgba8uint:a.RGBA,rgba8sint:a.RGBA,bgra8unorm:a.RGBA,"bgra8unorm-srgb":a.RGBA,rgb9e5ufloat:a.RGB,rgb10a2unorm:a.RGBA,rg11b10ufloat:a.RGB,rg32uint:a.RG,rg32sint:a.RG,rg32float:a.RG,rgba16uint:a.RGBA,rgba16sint:a.RGBA,rgba16float:a.RGBA,rgba32uint:a.RGBA,rgba32sint:a.RGBA,rgba32float:a.RGBA,stencil8:a.STENCIL_INDEX8,depth16unorm:a.DEPTH_COMPONENT,depth24plus:a.DEPTH_COMPONENT,"depth24plus-stencil8":a.DEPTH_STENCIL,depth32float:a.DEPTH_COMPONENT,"depth32float-stencil8":a.DEPTH_STENCIL}}this._managedTextures.removeAll(!0),this._glSamplers=Object.create(null),this._boundSamplers=Object.create(null),this._premultiplyAlpha=!1;for(let a=0;a<16;a++)this.bind(s.Texture.EMPTY,a)}initSource(a){this.bind(a)}bind(a,b=0){let c=a.source;a?(this.bindSource(c,b),this._useSeparateSamplers&&this._bindSampler(c.style,b)):(this.bindSource(null,b),this._useSeparateSamplers&&this._bindSampler(null,b))}bindSource(a,b=0){let c=this._gl;if(a._gcLastUsed=this._renderer.gc.now,this._boundTextures[b]!==a){this._boundTextures[b]=a,this._activateLocation(b),a||(a=s.Texture.EMPTY.source);let d=this.getGlSource(a);c.bindTexture(d.target,d.texture)}}_bindSampler(a,b=0){let c=this._gl;if(!a){this._boundSamplers[b]=null,c.bindSampler(b,null);return}let d=this._getGlSampler(a);this._boundSamplers[b]!==d&&(this._boundSamplers[b]=d,c.bindSampler(b,d))}unbind(a){let b=a.source,c=this._boundTextures,d=this._gl;for(let a=0;a<c.length;a++)if(c[a]===b){this._activateLocation(a);let e=this.getGlSource(b);d.bindTexture(e.target,null),c[a]=null}}_activateLocation(a){this._activeTextureLocation!==a&&(this._activeTextureLocation=a,this._gl.activeTexture(this._gl.TEXTURE0+a))}_initSource(a){let b=new aH(this._gl.createTexture());if(b.type=this._mapFormatToType[a.format],b.internalFormat=this._mapFormatToInternalFormat[a.format],b.format=this._mapFormatToFormat[a.format],a.autoGenerateMipmaps&&(this._renderer.context.supports.nonPowOf2mipmaps||a.isPowerOfTwo)){let b=Math.max(a.width,a.height);a.mipLevelCount=Math.floor(Math.log2(b))+1}return a._gpuData[this._renderer.uid]=b,this._managedTextures.add(a)&&(a.on("update",this.onSourceUpdate,this),a.on("resize",this.onSourceUpdate,this),a.on("styleChange",this.onStyleChange,this),a.on("updateMipmaps",this.onUpdateMipmaps,this)),this.onSourceUpdate(a),this.updateStyle(a,!1),b}onStyleChange(a){this.updateStyle(a,!1)}updateStyle(a,b){let c=this._gl,d=this.getGlSource(a);c.bindTexture(c.TEXTURE_2D,d.texture),this._boundTextures[this._activeTextureLocation]=a,aR(a.style,c,a.mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",c.TEXTURE_2D,!this._renderer.context.supports.nonPowOf2wrapping&&!a.isPowerOfTwo,b)}onSourceUnload(a,b=!1){let c=a._gpuData[this._renderer.uid];c&&(b||(this.unbind(a),this._gl.deleteTexture(c.texture)),a.off("update",this.onSourceUpdate,this),a.off("resize",this.onSourceUpdate,this),a.off("styleChange",this.onStyleChange,this),a.off("updateMipmaps",this.onUpdateMipmaps,this))}onSourceUpdate(a){let b=this._gl,c=this.getGlSource(a);b.bindTexture(b.TEXTURE_2D,c.texture),this._boundTextures[this._activeTextureLocation]=a;let d="premultiply-alpha-on-upload"===a.alphaMode;this._premultiplyAlpha!==d&&(this._premultiplyAlpha=d,b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,d)),this._uploads[a.uploadMethodId]?this._uploads[a.uploadMethodId].upload(a,c,b,this._renderer.context.webGLVersion):b.texImage2D(b.TEXTURE_2D,0,c.internalFormat,a.pixelWidth,a.pixelHeight,0,c.format,c.type,null),a.autoGenerateMipmaps&&a.mipLevelCount>1&&this.onUpdateMipmaps(a,!1)}onUpdateMipmaps(a,b=!0){b&&this.bindSource(a,0);let c=this.getGlSource(a);this._gl.generateMipmap(c.target)}_initSampler(a){let b=this._gl,c=this._gl.createSampler();return this._glSamplers[a._resourceId]=c,aR(a,b,this._boundTextures[this._activeTextureLocation].mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",c,!1,!0),this._glSamplers[a._resourceId]}_getGlSampler(a){return this._glSamplers[a._resourceId]||this._initSampler(a)}getGlSource(a){return a._gcLastUsed=this._renderer.gc.now,a._gpuData[this._renderer.uid]||this._initSource(a)}generateCanvas(a){let{pixels:b,width:c,height:d}=this.getPixels(a),e=F.DOMAdapter.get().createCanvas();e.width=c,e.height=d;let f=e.getContext("2d");if(f){let a=f.createImageData(c,d);a.data.set(b),f.putImageData(a,0,0)}return e}getPixels(a){let b=a.source.resolution,c=a.frame,d=Math.max(Math.round(c.width*b),1),e=Math.max(Math.round(c.height*b),1),f=new Uint8Array(4*d*e),g=this._renderer,h=g.renderTarget.getRenderTarget(a),i=g.renderTarget.getGpuRenderTarget(h),j=g.gl;return j.bindFramebuffer(j.FRAMEBUFFER,i.resolveTargetFramebuffer),j.readPixels(Math.round(c.x*b),Math.round(c.y*b),d,e,j.RGBA,j.UNSIGNED_BYTE,f),{pixels:new Uint8ClampedArray(f.buffer),width:d,height:e}}destroy(){this._managedTextures.destroy(),this._glSamplers=null,this._boundTextures=null,this._boundSamplers=null,this._mapFormatToInternalFormat=null,this._mapFormatToType=null,this._mapFormatToFormat=null,this._uploads=null,this._renderer=null}resetState(){this._activeTextureLocation=-1,this._boundTextures.fill(s.Texture.EMPTY.source),this._boundSamplers=Object.create(null);let a=this._gl;this._premultiplyAlpha=!1,a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha)}}aS.extension={type:[g.ExtensionType.WebGLSystem],name:"texture"};let aT=[...y.SharedSystems,ai,V,G,Z,E,aS,ap,Q,aF,aB,X,aG,aa,W],aU=[...y.SharedRenderPipes],aV=[w,u,q],aW=[],aX=[],aY=[];g.extensions.handleByNamedList(g.ExtensionType.WebGLSystem,aW),g.extensions.handleByNamedList(g.ExtensionType.WebGLPipes,aX),g.extensions.handleByNamedList(g.ExtensionType.WebGLPipesAdaptor,aY),g.extensions.add(...aT,...aU,...aV);class aZ extends x.AbstractRenderer{constructor(){super({name:"webgl",type:z.RendererType.WEBGL,systems:aW,renderPipes:aX,renderPipeAdaptors:aY})}}a.s(["WebGLRenderer",()=>aZ],97380)}];

//# sourceMappingURL=node_modules_pixi_js_lib_rendering_renderers_gl_WebGLRenderer_mjs_b7ff51af._.js.map