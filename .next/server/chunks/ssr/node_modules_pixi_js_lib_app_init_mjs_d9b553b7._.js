module.exports=[39128,4941,99445,93640,20363,41851,95535,11252,46155,32419,a=>{"use strict";let b,c,d,e,f;var g=a.i(44373);class h{static init(a){Object.defineProperty(this,"resizeTo",{configurable:!0,set(a){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=a,a&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{let a,b;if(this._resizeTo){if(this._cancelResize(),this._resizeTo===globalThis.window)a=globalThis.innerWidth,b=globalThis.innerHeight;else{let{clientWidth:c,clientHeight:d}=this._resizeTo;a=c,b=d}this.renderer.resize(a,b),this.render()}},this._resizeId=null,this._resizeTo=null,this.resizeTo=a.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}h.extension=g.ExtensionType.Application;var i=a.i(83019),j=a.i(83717);class k{static init(a){a=Object.assign({autoStart:!0,sharedTicker:!1},a),Object.defineProperty(this,"ticker",{configurable:!0,set(a){this._ticker&&this._ticker.remove(this.render,this),this._ticker=a,a&&a.add(this.render,this,i.UPDATE_PRIORITY.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=a.sharedTicker?j.Ticker.shared:new j.Ticker,a.autoStart&&this.start()}static destroy(){if(this._ticker){let a=this._ticker;this.ticker=null,a.destroy()}}}k.extension=g.ExtensionType.Application,g.extensions.add(h),g.extensions.add(k),a.s([],39128);var l=a.i(68667),m=a.i(45287),n=a.i(46629),o=a.i(3832),p=a.i(12874),q=a.i(48957);class r{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(a=>{o.BigPool.return(a)}),this.batches.length=0}}class s{constructor(a,b){this.state=m.State.for2d(),this.renderer=a,this._adaptor=b,this.renderer.runners.contextChange.add(this),this._managedGraphics=new n.GCManagedHash({renderer:a,type:"renderable",priority:-1,name:"graphics"})}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(a){let b=a.context,c=!!a._gpuData,d=this.renderer.graphicsContext.updateGpuContext(b);return!!d.isBatchable||c!==d.isBatchable}addRenderable(a,b){let c=this.renderer.graphicsContext.updateGpuContext(a.context);a.didViewUpdate&&this._rebuild(a),c.isBatchable?this._addToBatcher(a,b):(this.renderer.renderPipes.batch.break(b),b.add(a))}updateRenderable(a){let b=this._getGpuDataForRenderable(a).batches;for(let a=0;a<b.length;a++){let c=b[a];c._batcher.updateElement(c)}}execute(a){if(!a.isRenderable)return;let b=this.renderer,c=a.context;if(!b.graphicsContext.getGpuContext(c).batches.length)return;let d=c.customShader||this._adaptor.shader;this.state.blendMode=a.groupBlendMode;let e=d.resources.localUniforms.uniforms;e.uTransformMatrix=a.groupTransform,e.uRound=b._roundPixels|a._roundPixels,(0,p.color32BitToUniform)(a.groupColorAlpha,e.uColor,0),this._adaptor.execute(this,a)}_rebuild(a){let b=this._getGpuDataForRenderable(a),c=this.renderer.graphicsContext.updateGpuContext(a.context);b.destroy(),c.isBatchable&&this._updateBatchesForRenderable(a,b)}_addToBatcher(a,b){let c=this.renderer.renderPipes.batch,d=this._getGpuDataForRenderable(a).batches;for(let a=0;a<d.length;a++){let e=d[a];c.addToBatch(e,b)}}_getGpuDataForRenderable(a){return a._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(a)}_initGpuDataForRenderable(a){let b=new r;return a._gpuData[this.renderer.uid]=b,this._managedGraphics.add(a),b}_updateBatchesForRenderable(a,b){let c=a.context,d=this.renderer.graphicsContext.getGpuContext(c),e=this.renderer._roundPixels|a._roundPixels;b.batches=d.batches.map(b=>{let c=o.BigPool.get(q.BatchableGraphics);return b.copyTo(c),c.renderable=a,c.roundPixels=e,c})}destroy(){this._managedGraphics.destroy(),this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}s.extension={type:[g.ExtensionType.WebGLPipes,g.ExtensionType.WebGPUPipes,g.ExtensionType.CanvasPipes],name:"graphics"},g.extensions.add(s),g.extensions.add(l.GraphicsContextSystem),a.s([],4941);var t=a.i(67309),u=a.i(74395),v=a.i(96335),w=a.i(11276);class x{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(a){this._topology=a}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(a){this.texture!==a&&(this.texture=a,this._textureMatrixUpdateId=-1)}get uvs(){let a=this.geometry.getBuffer("aUV"),b=a.data,c=b,d=this.texture.textureMatrix;return d.isSimple||(c=this._transformedUvs,(this._textureMatrixUpdateId!==d._updateID||this._uvUpdateId!==a._updateID)&&((!c||c.length<b.length)&&(c=this._transformedUvs=new Float32Array(b.length)),this._textureMatrixUpdateId=d._updateID,this._uvUpdateId=a._updateID,d.multiplyUvs(b,c))),c}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}class y{destroy(){}}class z{constructor(a,b){this.localUniforms=new v.UniformGroup({uTransformMatrix:{value:new t.Matrix,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new u.BindGroup({0:this.localUniforms}),this.renderer=a,this._adaptor=b,this._adaptor.init()}validateRenderable(a){let b=this._getMeshData(a),c=b.batched,d=a.batched;if(b.batched=d,c!==d)return!0;if(d){let c=a._geometry;if(c.indices.length!==b.indexSize||c.positions.length!==b.vertexSize)return b.indexSize=c.indices.length,b.vertexSize=c.positions.length,!0;let d=this._getBatchableMesh(a);return d.texture.uid!==a._texture.uid&&(d._textureMatrixUpdateId=-1),!d._batcher.checkAndUpdateTexture(d,a._texture)}return!1}addRenderable(a,b){let c=this.renderer.renderPipes.batch,d=this._getMeshData(a);if(a.didViewUpdate&&(d.indexSize=a._geometry.indices?.length,d.vertexSize=a._geometry.positions?.length),d.batched){let d=this._getBatchableMesh(a);d.setTexture(a._texture),d.geometry=a._geometry,c.addToBatch(d,b)}else c.break(b),b.add(a)}updateRenderable(a){if(a.batched){let b=this._getBatchableMesh(a);b.setTexture(a._texture),b.geometry=a._geometry,b._batcher.updateElement(b)}}execute(a){if(!a.isRenderable)return;a.state.blendMode=(0,w.getAdjustedBlendModeBlend)(a.groupBlendMode,a.texture._source);let b=this.localUniforms;b.uniforms.uTransformMatrix=a.groupTransform,b.uniforms.uRound=this.renderer._roundPixels|a._roundPixels,b.update(),(0,p.color32BitToUniform)(a.groupColorAlpha,b.uniforms.uColor,0),this._adaptor.execute(this,a)}_getMeshData(a){var b,c;return(b=a._gpuData)[c=this.renderer.uid]||(b[c]=new y),a._gpuData[this.renderer.uid].meshData||this._initMeshData(a)}_initMeshData(a){return a._gpuData[this.renderer.uid].meshData={batched:a.batched,indexSize:0,vertexSize:0},a._gpuData[this.renderer.uid].meshData}_getBatchableMesh(a){var b,c;return(b=a._gpuData)[c=this.renderer.uid]||(b[c]=new y),a._gpuData[this.renderer.uid].batchableMesh||this._initBatchableMesh(a)}_initBatchableMesh(a){let b=new x;return b.renderable=a,b.setTexture(a._texture),b.transform=a.groupTransform,b.roundPixels=this.renderer._roundPixels|a._roundPixels,a._gpuData[this.renderer.uid].batchableMesh=b,b}destroy(){this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}z.extension={type:[g.ExtensionType.WebGLPipes,g.ExtensionType.WebGPUPipes,g.ExtensionType.CanvasPipes],name:"mesh"},g.extensions.add(z),a.s([],99445);class A{execute(a,b){let c=a.state,d=a.renderer,e=b.shader||a.defaultShader;e.resources.uTexture=b.texture._source,e.resources.uniforms=a.localUniforms;let f=d.gl,g=a.getBuffers(b);d.shader.bind(e),d.state.set(c),d.geometry.bind(g.geometry,e.glProgram);let h=2===g.geometry.indexBuffer.data.BYTES_PER_ELEMENT?f.UNSIGNED_SHORT:f.UNSIGNED_INT;f.drawElements(f.TRIANGLES,6*b.particleChildren.length,h,0)}}var B=a.i(42682),C=a.i(52776),D=a.i(54676),E=a.i(70770),F=a.i(29938);function G(a,b=null){let c=6*a;if(c>65535?b||(b=new Uint32Array(c)):b||(b=new Uint16Array(c)),b.length!==c)throw Error(`Out buffer length is incorrect, got ${b.length} and expected ${c}`);for(let a=0,d=0;a<c;a+=6,d+=4)b[a+0]=d+0,b[a+1]=d+1,b[a+2]=d+2,b[a+3]=d+0,b[a+4]=d+2,b[a+5]=d+3;return b}function H(a,b){let c=[];c.push(`

        var index = 0;

        for (let i = 0; i < ps.length; ++i)
        {
            const p = ps[i];

            `);let d=0;for(let e in a){let f=a[e];b===f.dynamic&&(c.push(`offset = index + ${d}`),c.push(f.code),d+=(0,E.getAttributeInfoFromFormat)(f.format).stride/4)}return c.push(`
            index += stride * 4;
        }
    `),c.unshift(`
        var stride = ${d};
    `),Function("ps","f32v","u32v",c.join("\n"))}class I{constructor(a){this._size=0,this._generateParticleUpdateCache={};const b=this._size=a.size??1e3,c=a.properties;let d=0,e=0;for(const a in c){const b=c[a],f=(0,E.getAttributeInfoFromFormat)(b.format);b.dynamic?e+=f.stride:d+=f.stride}this._dynamicStride=e/4,this._staticStride=d/4,this.staticAttributeBuffer=new F.ViewableBuffer(4*b*d),this.dynamicAttributeBuffer=new F.ViewableBuffer(4*b*e),this.indexBuffer=G(b);const f=new D.Geometry;let g=0,h=0;for(const a in this._staticBuffer=new B.Buffer({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:C.BufferUsage.VERTEX|C.BufferUsage.COPY_DST}),this._dynamicBuffer=new B.Buffer({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:C.BufferUsage.VERTEX|C.BufferUsage.COPY_DST}),c){const b=c[a],d=(0,E.getAttributeInfoFromFormat)(b.format);b.dynamic?(f.addAttribute(b.attributeName,{buffer:this._dynamicBuffer,stride:4*this._dynamicStride,offset:4*g,format:b.format}),g+=d.size):(f.addAttribute(b.attributeName,{buffer:this._staticBuffer,stride:4*this._staticStride,offset:4*h,format:b.format}),h+=d.size)}f.addIndex(this.indexBuffer);const i=this.getParticleUpdate(c);this._dynamicUpload=i.dynamicUpdate,this._staticUpload=i.staticUpdate,this.geometry=f}getParticleUpdate(a){let b=function(a){let b=[];for(let c in a){let d=a[c];b.push(c,d.code,d.dynamic?"d":"s")}return b.join("_")}(a);return this._generateParticleUpdateCache[b]||(this._generateParticleUpdateCache[b]=this.generateParticleUpdate(a)),this._generateParticleUpdateCache[b]}generateParticleUpdate(a){return{dynamicUpdate:H(a,!0),staticUpdate:H(a,!1)}}update(a,b){a.length>this._size&&(b=!0,this._size=Math.max(a.length,1.5*this._size|0),this.staticAttributeBuffer=new F.ViewableBuffer(this._size*this._staticStride*16),this.dynamicAttributeBuffer=new F.ViewableBuffer(this._size*this._dynamicStride*16),this.indexBuffer=G(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));let c=this.dynamicAttributeBuffer;if(this._dynamicUpload(a,c.float32View,c.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,a.length*this._dynamicStride*4,!0),b){let b=this.staticAttributeBuffer;this._staticUpload(a,b.float32View,b.uint32View),this._staticBuffer.setDataWithSize(b.float32View,a.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}var J=a.i(98063),K=a.i(53229),L=a.i(66722),M=a.i(56312),N=a.i(71805),O=a.i(94214),P="\nstruct ParticleUniforms {\n  uTranslationMatrix:mat3x3<f32>,\n  uColor:vec4<f32>,\n  uRound:f32,\n  uResolution:vec2<f32>,\n};\n\nfn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>\n{\n  return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\n@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;\n\n@group(1) @binding(0) var uTexture: texture_2d<f32>;\n@group(1) @binding(1) var uSampler : sampler;\n\nstruct VSOutput {\n    @builtin(position) position: vec4<f32>,\n    @location(0) uv : vec2<f32>,\n    @location(1) color : vec4<f32>,\n  };\n@vertex\nfn mainVertex(\n  @location(0) aVertex: vec2<f32>,\n  @location(1) aPosition: vec2<f32>,\n  @location(2) aUV: vec2<f32>,\n  @location(3) aColor: vec4<f32>,\n  @location(4) aRotation: f32,\n) -> VSOutput {\n  \n   let v = vec2(\n       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),\n       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)\n   ) + aPosition;\n\n   var position = vec4((uniforms.uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n   if(uniforms.uRound == 1.0) {\n       position = vec4(roundPixels(position.xy, uniforms.uResolution), position.zw);\n   }\n\n    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;\n\n  return VSOutput(\n   position,\n   aUV,\n   vColor,\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n  @location(1) color: vec4<f32>,\n  @builtin(position) position: vec4<f32>,\n) -> @location(0) vec4<f32> {\n\n    var sample = textureSample(uTexture, uSampler, uv) * color;\n   \n    return sample;\n}";class Q extends M.Shader{constructor(){super({glProgram:K.GlProgram.from({vertex:"attribute vec2 aVertex;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nattribute vec2 aPosition;\nattribute float aRotation;\n\nuniform mat3 uTranslationMatrix;\nuniform float uRound;\nuniform vec2 uResolution;\nuniform vec4 uColor;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\n\nvec2 roundPixels(vec2 position, vec2 targetSize)\n{       \n    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;\n}\n\nvoid main(void){\n    float cosRotation = cos(aRotation);\n    float sinRotation = sin(aRotation);\n    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;\n    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;\n\n    vec2 v = vec2(x, y);\n    v = v + aPosition;\n\n    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    if(uRound == 1.0)\n    {\n        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);\n    }\n\n    vUV = aUV;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;\n}\n",fragment:"varying vec2 vUV;\nvarying vec4 vColor;\n\nuniform sampler2D uTexture;\n\nvoid main(void){\n    vec4 color = texture2D(uTexture, vUV) * vColor;\n    gl_FragColor = color;\n}"}),gpuProgram:L.GpuProgram.from({fragment:{source:P,entryPoint:"mainFragment"},vertex:{source:P,entryPoint:"mainVertex"}}),resources:{uTexture:N.Texture.WHITE.source,uSampler:new O.TextureStyle({}),uniforms:{uTranslationMatrix:{value:new t.Matrix,type:"mat3x3<f32>"},uColor:{value:new J.Color(0xffffff),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class R{constructor(a,b){this.state=m.State.for2d(),this.localUniforms=new v.UniformGroup({uTranslationMatrix:{value:new t.Matrix,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=a,this.adaptor=b,this.defaultShader=new Q,this.state=m.State.for2d(),this._managedContainers=new n.GCManagedHash({renderer:a,type:"renderable",name:"particleContainer"})}validateRenderable(a){return!1}addRenderable(a,b){this.renderer.renderPipes.batch.break(b),b.add(a)}getBuffers(a){return a._gpuData[this.renderer.uid]||this._initBuffer(a)}_initBuffer(a){return a._gpuData[this.renderer.uid]=new I({size:a.particleChildren.length,properties:a._properties}),this._managedContainers.add(a),a._gpuData[this.renderer.uid]}updateRenderable(a){}execute(a){let b=a.particleChildren;if(0===b.length)return;let c=this.renderer,d=this.getBuffers(a);a.texture||(a.texture=b[0].texture);let e=this.state;d.update(b,a._childrenDirty),a._childrenDirty=!1,e.blendMode=(0,w.getAdjustedBlendModeBlend)(a.blendMode,a.texture._source);let f=this.localUniforms.uniforms,g=f.uTranslationMatrix;a.worldTransform.copyTo(g),g.prepend(c.globalUniforms.globalUniformData.projectionMatrix),f.uResolution=c.globalUniforms.globalUniformData.resolution,f.uRound=c._roundPixels|a._roundPixels,(0,p.color32BitToUniform)(a.groupColorAlpha,f.uColor,0),this.adaptor.execute(this,a)}destroy(){this._managedContainers.destroy(),this.renderer=null,this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class S extends R{constructor(a){super(a,new A)}}S.extension={type:[g.ExtensionType.WebGLPipes],name:"particle"};class T{execute(a,b){let c=a.renderer,d=b.shader||a.defaultShader;d.groups[0]=c.renderPipes.uniformBatch.getUniformBindGroup(a.localUniforms,!0),d.groups[1]=c.texture.getTextureBindGroup(b.texture);let e=a.state,f=a.getBuffers(b);c.encoder.draw({geometry:f.geometry,shader:b.shader||a.defaultShader,state:e,size:6*b.particleChildren.length})}}class U extends R{constructor(a){super(a,new T)}}U.extension={type:[g.ExtensionType.WebGPUPipes],name:"particle"},g.extensions.add(S),g.extensions.add(U),a.s([],93640);var V=a.i(98803);function W(a,b){let{texture:c,bounds:d}=a,e=b._style._getFinalPadding();(0,V.updateQuadBounds)(d,b._anchor,c);let f=b._anchor._x*e*2,g=b._anchor._y*e*2;d.minX-=e-f,d.minY-=e-g,d.maxX-=e-f,d.maxY-=e-g}var X=a.i(28343);class Y extends X.BatchableSprite{}class Z{constructor(a){this._renderer=a,a.runners.resolutionChange.add(this),this._managedTexts=new n.GCManagedHash({renderer:a,type:"renderable",onUnload:this.onTextUnload.bind(this),name:"canvasText"})}resolutionChange(){for(let a in this._managedTexts.items){let b=this._managedTexts.items[a];b?._autoResolution&&b.onViewUpdate()}}validateRenderable(a){let b=this._getGpuText(a),c=a.styleKey;return b.currentKey!==c||a._didTextUpdate}addRenderable(a,b){let c=this._getGpuText(a);if(a._didTextUpdate){let b=a._autoResolution?this._renderer.resolution:a.resolution;(c.currentKey!==a.styleKey||a.resolution!==b)&&this._updateGpuText(a),a._didTextUpdate=!1,W(c,a)}this._renderer.renderPipes.batch.addToBatch(c,b)}updateRenderable(a){let b=this._getGpuText(a);b._batcher.updateElement(b)}_updateGpuText(a){let b=this._getGpuText(a);b.texture&&this._renderer.canvasText.decreaseReferenceCount(b.currentKey),a._resolution=a._autoResolution?this._renderer.resolution:a.resolution,b.texture=this._renderer.canvasText.getManagedTexture(a),b.currentKey=a.styleKey}_getGpuText(a){return a._gpuData[this._renderer.uid]||this.initGpuText(a)}initGpuText(a){let b=new Y;return b.currentKey="--",b.renderable=a,b.transform=a.groupTransform,b.bounds={minX:0,maxX:1,minY:0,maxY:0},b.roundPixels=this._renderer._roundPixels|a._roundPixels,a._gpuData[this._renderer.uid]=b,this._managedTexts.add(a),b}onTextUnload(a){let b=a._gpuData[this._renderer.uid];if(!b)return;let{canvasText:c}=this._renderer;c.getReferenceCount(b.currentKey)>0?c.decreaseReferenceCount(b.currentKey):b.texture&&c.returnTexture(b.texture)}destroy(){this._managedTexts.destroy(),this._renderer=null}}Z.extension={type:[g.ExtensionType.WebGLPipes,g.ExtensionType.WebGPUPipes,g.ExtensionType.CanvasPipes],name:"text"};var $=a.i(36206),_=a.i(2897),aa=a.i(25974),ab=a.i(83813);let ac=new ab.Bounds;function ad(a,b,c,d){ac.minX=0,ac.minY=0,ac.maxX=a.width/d|0,ac.maxY=a.height/d|0;let e=$.TexturePool.getOptimalTexture(ac.width,ac.height,d,!1);return e.source.uploadMethodId="image",e.source.resource=a,e.source.alphaMode="premultiply-alpha-on-upload",e.frame.width=b/d,e.frame.height=c/d,e.source.emit("update",e.source),e.updateUvs(),e}var ae=a.i(37897);class af{constructor(a){this._activeTextures={},this._renderer=a}getTexture(a,b,c,d){"string"==typeof a&&((0,_.deprecation)("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),a={text:a,style:c,resolution:b}),a.style instanceof aa.TextStyle||(a.style=new aa.TextStyle(a.style)),a.textureStyle instanceof O.TextureStyle||(a.textureStyle=new O.TextureStyle(a.textureStyle)),"string"!=typeof a.text&&(a.text=a.text.toString());let{text:e,style:f,textureStyle:g}=a,h=a.resolution??this._renderer.resolution,{frame:i,canvasAndContext:j}=ae.CanvasTextGenerator.getCanvasAndContext({text:e,style:f,resolution:h}),k=ad(j.canvas,i.width,i.height,h);if(g&&(k.source.style=g),f.trim&&(i.pad(f.padding),k.frame.copyFrom(i),k.frame.scale(1/h),k.updateUvs()),f.filters){let a=this._applyFilters(k,f.filters);return this.returnTexture(k),ae.CanvasTextGenerator.returnCanvasAndContext(j),a}return this._renderer.texture.initSource(k._source),ae.CanvasTextGenerator.returnCanvasAndContext(j),k}returnTexture(a){let b=a.source;b.resource=null,b.uploadMethodId="unknown",b.alphaMode="no-premultiply-alpha",$.TexturePool.returnTexture(a,!0)}renderTextToCanvas(){(0,_.deprecation)("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}getManagedTexture(a){a._resolution=a._autoResolution?this._renderer.resolution:a.resolution;let b=a.styleKey;if(this._activeTextures[b])return this._increaseReferenceCount(b),this._activeTextures[b].texture;let c=this.getTexture({text:a.text,style:a.style,resolution:a._resolution,textureStyle:a.textureStyle});return this._activeTextures[b]={texture:c,usageCount:1},c}decreaseReferenceCount(a){let b=this._activeTextures[a];b.usageCount--,0===b.usageCount&&(this.returnTexture(b.texture),this._activeTextures[a]=null)}getReferenceCount(a){return this._activeTextures[a]?.usageCount??0}_increaseReferenceCount(a){this._activeTextures[a].usageCount++}_applyFilters(a,b){let c=this._renderer.renderTarget.renderTarget,d=this._renderer.filter.generateFilteredTexture({texture:a,filters:b});return this._renderer.renderTarget.bind(c,!1),d}destroy(){for(let a in this._renderer=null,this._activeTextures)this._activeTextures[a]&&this.returnTexture(this._activeTextures[a].texture);this._activeTextures=null}}af.extension={type:[g.ExtensionType.WebGLSystem,g.ExtensionType.WebGPUSystem,g.ExtensionType.CanvasSystem],name:"canvasText"},g.extensions.add(af),g.extensions.add(Z),a.s([],20363);var ag=a.i(33221),ah=a.i(28136),ai=a.i(92158),aj=a.i(35235),ak=a.i(55960),al=a.i(28012),am=a.i(586),an=a.i(90074),ao=M;let ap={name:"local-uniform-msdf-bit",vertex:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32,
                uRound:f32,
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `},fragment:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
         `,main:`
            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));
        `}},aq={name:"local-uniform-msdf-bit",vertex:{header:`
            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix *= uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `},fragment:{header:`
            uniform float uDistance;
         `,main:`
            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));
        `}},ar={name:"msdf-bit",fragment:{header:`
            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {

                // MSDF
                var median = msdfColor.r + msdfColor.g + msdfColor.b -
                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                var screenPxDistance = distance * (median - 0.5);
                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));
                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);
                var coverage: f32 = pow(shapeColor.a * alpha, gamma);

                return coverage;

            }
        `}},as={name:"msdf-bit",fragment:{header:`
            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {

                // MSDF
                float median = msdfColor.r + msdfColor.g + msdfColor.b -
                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                float screenPxDistance = distance * (median - 0.5);
                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);

                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));
                float gamma = mix(1.0, 1.0 / 2.2, luma);
                float coverage = pow(shapeColor.a * alpha, gamma);

                return coverage;
            }
        `}};class at extends ao.Shader{constructor(a){const d=new v.UniformGroup({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new t.Matrix,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}});b??(b=(0,aj.compileHighShaderGpuProgram)({name:"sdf-shader",bits:[ak.colorBit,(0,al.generateTextureBatchBit)(a),ap,ar,am.roundPixelsBit]})),c??(c=(0,aj.compileHighShaderGlProgram)({name:"sdf-shader",bits:[ak.colorBitGl,(0,al.generateTextureBatchBitGl)(a),aq,as,am.roundPixelsBitGl]})),super({glProgram:c,gpuProgram:b,resources:{localUniforms:d,batchSamplers:(0,an.getBatchSamplersUniformGroup)(a)}})}}var au=a.i(24126),av=a.i(51983),aw=a.i(31023),ax=a.i(9124),ay=a.i(19548),az=a.i(32631),aA=a.i(98051),aB=a.i(61607);class aC extends aB.default{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return(0,_.deprecation)(_.v8_0_0,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return(0,_.deprecation)(_.v8_0_0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return(0,_.deprecation)(_.v8_0_0,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return(0,_.deprecation)(_.v8_0_0,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return(0,_.deprecation)(_.v8_0_0,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(a=!1){for(let a in this.emit("destroy",this),this.removeAllListeners(),this.chars)this.chars[a].texture?.destroy();this.chars=null,a&&(this.pages.forEach(a=>a.texture.destroy(!0)),this.pages=null)}}let aD=class a extends aC{constructor(b){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const c={...a.defaultOptions,...b};this._textureSize=c.textureSize,this._mipmap=c.mipmap;const d=c.style.clone();c.overrideFill&&(d._fill.color=0xffffff,d._fill.alpha=1,d._fill.texture=N.Texture.WHITE,d._fill.fill=null),this.applyFillAsTint=c.overrideFill;const e=d.fontSize;d.fontSize=this.baseMeasurementFontSize;const f=(0,az.fontStringFromTextStyle)(d);c.overrideSize?d._stroke&&(d._stroke.width*=this.baseRenderedFontSize/e):d.fontSize=this.baseRenderedFontSize=e,this._style=d,this._skipKerning=c.skipKerning??!1,this.resolution=c.resolution??1,this._padding=c.padding??4,c.textureStyle&&(this._textureStyle=c.textureStyle instanceof O.TextureStyle?c.textureStyle:new O.TextureStyle(c.textureStyle)),this.fontMetrics=ai.CanvasTextMetrics.measureFont(f),this.lineHeight=d.lineHeight||this.fontMetrics.fontSize||d.fontSize}ensureCharacters(a){let b,c=ai.CanvasTextMetrics.graphemeSegmenter(a).filter(a=>!this._currentChars.includes(a)).filter((a,b,c)=>c.indexOf(a)===b);if(!c.length)return;this._currentChars=[...this._currentChars,...c];let{canvas:d,context:e}=(b=-1===this._currentPageIndex?this._nextPage():this.pages[this._currentPageIndex]).canvasAndContext,f=b.texture.source,g=this._style,h=this._currentX,i=this._currentY,j=this._currentMaxCharHeight,k=this.baseRenderedFontSize/this.baseMeasurementFontSize,l=this._padding*k,m=!1,n=d.width/this.resolution,o=d.height/this.resolution;for(let a=0;a<c.length;a++){let b=c[a],p=ai.CanvasTextMetrics.measureText(b,g,d,!1);p.lineHeight=p.height;let q=p.width*k,r=Math.ceil(("italic"===g.fontStyle?2:1)*q),s=p.height*k,t=r+2*l,u=s+2*l;if(m=!1,"\n"!==b&&"\r"!==b&&"	"!==b&&" "!==b&&(m=!0,j=Math.ceil(Math.max(u,j))),h+t>n&&(h=0,(i+=j)+(j=u)>o)){f.update();let a=this._nextPage();d=a.canvasAndContext.canvas,e=a.canvasAndContext.context,f=a.texture.source,h=0,i=0,j=0}let v=q/k-(g.dropShadow?.distance??0)-(g._stroke?.width??0);if(this.chars[b]={id:b.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:v,kerning:{}},m){this._drawGlyph(e,p,h+l,i+l,k,g);let a=f.width*k,c=f.height*k,d=new aw.Rectangle(h/a*f.width,i/c*f.height,t/a*f.width,u/c*f.height);this.chars[b].texture=new N.Texture({source:f,frame:d}),h+=Math.ceil(t)}}f.update(),this._currentX=h,this._currentY=i,this._currentMaxCharHeight=j,this._skipKerning&&this._applyKerning(c,e)}get pageTextures(){return(0,_.deprecation)(_.v8_0_0,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(a,b){let c=this._measureCache;for(let d=0;d<a.length;d++){let e=a[d];for(let a=0;a<this._currentChars.length;a++){let d=this._currentChars[a],f=c[e];f||(f=c[e]=b.measureText(e).width);let g=c[d];g||(g=c[d]=b.measureText(d).width);let h=b.measureText(e+d).width,i=h-(f+g);i&&(this.chars[e].kerning[d]=i),(i=(h=b.measureText(e+d).width)-(f+g))&&(this.chars[d].kerning[e]=i)}}}_nextPage(){this._currentPageIndex++;let a=this.resolution,b=ax.CanvasPool.getOptimalCanvasAndContext(this._textureSize,this._textureSize,a);this._setupContext(b.context,this._style,a);let c=a*(this.baseRenderedFontSize/this.baseMeasurementFontSize),d=new N.Texture({source:new ay.ImageSource({resource:b.canvas,resolution:c,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(d.source.style=this._textureStyle);let e={canvasAndContext:b,texture:d};return this.pages[this._currentPageIndex]=e,e}_setupContext(a,b,c){b.fontSize=this.baseRenderedFontSize,a.scale(c,c),a.font=(0,az.fontStringFromTextStyle)(b),b.fontSize=this.baseMeasurementFontSize,a.textBaseline=b.textBaseline;let d=b._stroke,e=d?.width??0;if(d&&(a.lineWidth=e,a.lineJoin=d.join,a.miterLimit=d.miterLimit,a.strokeStyle=(0,aA.getCanvasFillStyle)(d,a)),b._fill&&(a.fillStyle=(0,aA.getCanvasFillStyle)(b._fill,a)),b.dropShadow){let d=b.dropShadow,e=J.Color.shared.setValue(d.color).toArray(),f=d.blur*c,g=d.distance*c;a.shadowColor=`rgba(${255*e[0]},${255*e[1]},${255*e[2]},${d.alpha})`,a.shadowBlur=f,a.shadowOffsetX=Math.cos(d.angle)*g,a.shadowOffsetY=Math.sin(d.angle)*g}else a.shadowColor="black",a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0}_drawGlyph(a,b,c,d,e,f){let g=b.text,h=b.fontProperties,i=f._stroke,j=(i?.width??0)*e,k=c+j/2,l=d-j/2,m=h.descent*e,n=b.lineHeight*e,o=!1;f.stroke&&j&&(o=!0,a.strokeText(g,k,l+n-m));let{shadowBlur:p,shadowOffsetX:q,shadowOffsetY:r}=a;f._fill&&(o&&(a.shadowBlur=0,a.shadowOffsetX=0,a.shadowOffsetY=0),a.fillText(g,k,l+n-m)),o&&(a.shadowBlur=p,a.shadowOffsetX=q,a.shadowOffsetY=r)}destroy(){super.destroy();for(let a=0;a<this.pages.length;a++){let{canvasAndContext:b,texture:c}=this.pages[a];ax.CanvasPool.returnCanvasAndContext(b),c.destroy(!0)}this.pages=null}};function aE(a,b,c,d){let e={width:0,height:0,offsetY:0,scale:b.fontSize/c.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};e.offsetY=c.baseLineOffset;let f=e.lines[0],g=null,h=!0,i={spaceWord:!1,width:0,start:0,index:0,positions:[],chars:[]},j=c.baseMeasurementFontSize/b.fontSize,k=b.letterSpacing*j,l=b.wordWrapWidth*j,m=b.lineHeight?b.lineHeight*j:c.lineHeight,n=b.wordWrap&&b.breakWords,o=a=>{let b=f.width;for(let c=0;c<i.index;c++){let d=a.positions[c];f.chars.push(a.chars[c]),f.charPositions.push(d+b)}f.width+=a.width,h=!1,i.width=0,i.index=0,i.chars.length=0},p=()=>{let a=f.chars.length-1;if(d){let b=f.chars[a];for(;" "===b;)f.width-=c.chars[b].xAdvance,b=f.chars[--a]}e.width=Math.max(e.width,f.width),f={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},h=!0,e.lines.push(f),e.height+=m},q=a=>a-k>l;for(let d=0;d<a.length+1;d++){let e,j=d===a.length;j||(e=a[d]);let l=c.chars[e]||c.chars[" "];if(/(?:\s)/.test(e)||"\r"===e||"\n"===e||j){if(!h&&b.wordWrap&&q(f.width+i.width)?p():i.start=f.width,o(i),j||f.charPositions.push(0),"\r"===e||"\n"===e)p();else if(!j){let a=l.xAdvance+(l.kerning[g]||0)+k;f.width+=a,f.spaceWidth=a,f.spacesIndex.push(f.charPositions.length),f.chars.push(e)}}else{let a=l.kerning[g]||0,b=l.xAdvance+a+k;n&&q(f.width+i.width+b)&&(o(i),p()),i.positions[i.index++]=i.width+a,i.chars.push(e),i.width+=b}g=e}return p(),"center"===b.align?function(a){for(let b=0;b<a.lines.length;b++){let c=a.lines[b],d=a.width/2-c.width/2;for(let a=0;a<c.charPositions.length;a++)c.charPositions[a]+=d}}(e):"right"===b.align?function(a){for(let b=0;b<a.lines.length;b++){let c=a.lines[b],d=a.width-c.width;for(let a=0;a<c.charPositions.length;a++)c.charPositions[a]+=d}}(e):"justify"===b.align&&function(a){let b=a.width;for(let c=0;c<a.lines.length;c++){let d=a.lines[c],e=0,f=d.spacesIndex[e++],g=0,h=d.spacesIndex.length,i=(b-d.width)/h;for(let a=0;a<d.charPositions.length;a++)a===f&&(f=d.spacesIndex[e++],g+=i),d.charPositions[a]+=g}}(e),e}aD.defaultOptions={textureSize:512,style:new aa.TextStyle,mipmap:!0};let aF=0,aG=new class{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=(0,au.lru)(1e3)}getFont(a,b){let c=`${b.fontFamily}-bitmap`,d=!0;if(b._fill.fill&&!b._stroke?(c+=b._fill.fill.styleKey,d=!1):(b._stroke||b.dropShadow)&&(c=`${b.styleKey}-bitmap`,d=!1),!ag.Cache.has(c)){let a=Object.create(b);a.lineHeight=0;let e=new aD({style:a,overrideFill:d,overrideSize:!0,...this.defaultOptions});++aF>50&&(0,av.warn)("BitmapText",`You have dynamically created ${aF} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),e.once("destroy",()=>{aF--,ag.Cache.remove(c)}),ag.Cache.set(c,e)}let e=ag.Cache.get(c);return e.ensureCharacters?.(a),e}getLayout(a,b,c=!0){let d=this.getFont(a,b),e=`${a}-${b.styleKey}-${c}`;if(this.measureCache.has(e))return this.measureCache.get(e);let f=aE(ai.CanvasTextMetrics.graphemeSegmenter(a),b,d,c);return this.measureCache.set(e,f),f}measureText(a,b,c=!0){return this.getLayout(a,b,c)}install(...a){let b=a[0];"string"==typeof b&&(b={name:b,style:a[1],chars:a[2]?.chars,resolution:a[2]?.resolution,padding:a[2]?.padding,skipKerning:a[2]?.skipKerning},(0,_.deprecation)(_.v8_0_0,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));let c=b?.name;if(!c)throw Error("[BitmapFontManager] Property `name` is required.");let d=(b={...this.defaultOptions,...b}).style,e=d instanceof aa.TextStyle?d:new aa.TextStyle(d),f=b.dynamicFill??this._canUseTintForStyle(e),g=new aD({style:e,overrideFill:f,skipKerning:b.skipKerning,padding:b.padding,resolution:b.resolution,overrideSize:!1,textureStyle:b.textureStyle}),h=function(a){if(""===a)return[];"string"==typeof a&&(a=[a]);let b=[];for(let c=0,d=a.length;c<d;c++){let d=a[c];if(Array.isArray(d)){if(2!==d.length)throw Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${d.length}.`);if(0===d[0].length||0===d[1].length)throw Error("[BitmapFont]: Invalid character delimiter.");let a=d[0].charCodeAt(0),c=d[1].charCodeAt(0);if(c<a)throw Error("[BitmapFont]: Invalid character range.");for(let d=a;d<=c;d++)b.push(String.fromCharCode(d))}else b.push(...Array.from(d))}if(0===b.length)throw Error("[BitmapFont]: Empty set when resolving characters.");return b}(b.chars);return g.ensureCharacters(h.join("")),ag.Cache.set(`${c}-bitmap`,g),g.once("destroy",()=>ag.Cache.remove(`${c}-bitmap`)),g}uninstall(a){let b=`${a}-bitmap`,c=ag.Cache.get(b);c&&c.destroy()}_canUseTintForStyle(a){return!a._stroke&&(!a.dropShadow||0===a.dropShadow.color)&&!a._fill.fill&&0xffffff===a._fill.color}};class aH extends ah.Graphics{destroy(){this.context.customShader&&this.context.customShader.destroy(),super.destroy()}}class aI{constructor(a){this._renderer=a,this._managedBitmapTexts=new n.GCManagedHash({renderer:a,type:"renderable",priority:-2,name:"bitmapText"})}validateRenderable(a){let b=this._getGpuBitmapText(a);return this._renderer.renderPipes.graphics.validateRenderable(b)}addRenderable(a,b){let c=this._getGpuBitmapText(a);aJ(a,c),a._didTextUpdate&&(a._didTextUpdate=!1,this._updateContext(a,c)),this._renderer.renderPipes.graphics.addRenderable(c,b),c.context.customShader&&this._updateDistanceField(a)}updateRenderable(a){let b=this._getGpuBitmapText(a);aJ(a,b),this._renderer.renderPipes.graphics.updateRenderable(b),b.context.customShader&&this._updateDistanceField(a)}_updateContext(a,b){let{context:c}=b,d=aG.getFont(a.text,a._style);c.clear(),"none"===d.distanceField.type||c.customShader||(c.customShader=new at(this._renderer.limits.maxBatchableTextures));let e=ai.CanvasTextMetrics.graphemeSegmenter(a.text),f=a._style,g=d.baseLineOffset,h=aE(e,f,d,!0),i=f.padding,j=h.scale,k=h.width,l=h.height+h.offsetY;f._stroke&&(k+=f._stroke.width/j,l+=f._stroke.width/j),c.translate(-a._anchor._x*k-i,-a._anchor._y*l-i).scale(j,j);let m=d.applyFillAsTint?f._fill.color:0xffffff,n=d.fontMetrics.fontSize,o=d.lineHeight;f.lineHeight&&(n=f.fontSize/j,o=f.lineHeight/j);let p=(o-n)/2;p-d.baseLineOffset<0&&(p=0);for(let a=0;a<h.lines.length;a++){let b=h.lines[a];for(let a=0;a<b.charPositions.length;a++){let e=b.chars[a],f=d.chars[e];if(f?.texture){let d=f.texture;c.texture(d,m||"black",Math.round(b.charPositions[a]+f.xOffset),Math.round(g+f.yOffset+p),d.orig.width,d.orig.height)}}g+=o}}_getGpuBitmapText(a){return a._gpuData[this._renderer.uid]||this.initGpuText(a)}initGpuText(a){let b=new aH;return a._gpuData[this._renderer.uid]=b,this._updateContext(a,b),this._managedBitmapTexts.add(a),b}_updateDistanceField(a){let b=this._getGpuBitmapText(a).context,c=a._style.fontFamily,d=ag.Cache.get(`${c}-bitmap`),{a:e,b:f,c:g,d:h}=a.groupTransform,i=(Math.abs(Math.sqrt(e*e+f*f))+Math.abs(Math.sqrt(g*g+h*h)))/2,j=d.baseRenderedFontSize/a._style.fontSize,k=i*d.distanceField.range*(1/j);b.customShader.resources.localUniforms.uniforms.uDistance=k}destroy(){this._managedBitmapTexts.destroy(),this._renderer=null,this._managedBitmapTexts=null}}function aJ(a,b){b.groupTransform=a.groupTransform,b.groupColorAlpha=a.groupColorAlpha,b.groupColor=a.groupColor,b.groupBlendMode=a.groupBlendMode,b.globalDisplayStatus=a.globalDisplayStatus,b.groupTransform=a.groupTransform,b.localDisplayStatus=a.localDisplayStatus,b.groupAlpha=a.groupAlpha,b._roundPixels=a._roundPixels}aI.extension={type:[g.ExtensionType.WebGLPipes,g.ExtensionType.WebGPUPipes,g.ExtensionType.CanvasPipes],name:"bitmapText"},g.extensions.add(aI),a.s([],41851);var aK=X;class aL extends aK.BatchableSprite{constructor(){super(...arguments),this.generatingTexture=!1,this.currentKey="--"}destroy(){this.texturePromise=null,this.generatingTexture=!1,this.currentKey="--",super.destroy()}}class aM{constructor(a){this._renderer=a,a.runners.resolutionChange.add(this),this._managedTexts=new n.GCManagedHash({renderer:a,type:"renderable",onUnload:this.onTextUnload.bind(this),name:"htmlText"})}resolutionChange(){for(let a in this._managedTexts.items){let b=this._managedTexts.items[a];b?._autoResolution&&b.onViewUpdate()}}validateRenderable(a){let b=this._getGpuText(a),c=a.styleKey;return b.currentKey!==c}addRenderable(a,b){let c=this._getGpuText(a);if(a._didTextUpdate){let b=a._autoResolution?this._renderer.resolution:a.resolution;(c.currentKey!==a.styleKey||a.resolution!==b)&&this._updateGpuText(a).catch(a=>{console.error(a)}),a._didTextUpdate=!1,W(c,a)}this._renderer.renderPipes.batch.addToBatch(c,b)}updateRenderable(a){let b=this._getGpuText(a);b._batcher.updateElement(b)}async _updateGpuText(a){a._didTextUpdate=!1;let b=this._getGpuText(a);if(b.generatingTexture)return;let c=b.texturePromise;b.texturePromise=null,b.generatingTexture=!0,a._resolution=a._autoResolution?this._renderer.resolution:a.resolution;let d=this._renderer.htmlText.getTexturePromise(a);c&&(d=d.finally(()=>{this._renderer.htmlText.decreaseReferenceCount(b.currentKey),this._renderer.htmlText.returnTexturePromise(c)})),b.texturePromise=d,b.currentKey=a.styleKey,b.texture=await d;let e=a.renderGroup||a.parentRenderGroup;e&&(e.structureDidChange=!0),b.generatingTexture=!1,W(b,a)}_getGpuText(a){return a._gpuData[this._renderer.uid]||this.initGpuText(a)}initGpuText(a){let b=new aL;return b.renderable=a,b.transform=a.groupTransform,b.texture=N.Texture.EMPTY,b.bounds={minX:0,maxX:1,minY:0,maxY:0},b.roundPixels=this._renderer._roundPixels|a._roundPixels,a._resolution=a._autoResolution?this._renderer.resolution:a.resolution,a._gpuData[this._renderer.uid]=b,this._managedTexts.add(a),b}onTextUnload(a){let b=a._gpuData[this._renderer.uid];if(!b)return;let{htmlText:c}=this._renderer;null===c.getReferenceCount(b.currentKey)?c.returnTexturePromise(b.texturePromise):c.decreaseReferenceCount(b.currentKey)}destroy(){this._managedTexts.destroy(),this._renderer=null}}aM.extension={type:[g.ExtensionType.WebGLPipes,g.ExtensionType.WebGPUPipes,g.ExtensionType.CanvasPipes],name:"htmlText"};var aN=a.i(53507),aO=a.i(58422);let aP="http://www.w3.org/2000/svg",aQ="http://www.w3.org/1999/xhtml";class aR{constructor(){this.svgRoot=document.createElementNS(aP,"svg"),this.foreignObject=document.createElementNS(aP,"foreignObject"),this.domElement=document.createElementNS(aQ,"div"),this.styleElement=document.createElementNS(aQ,"style");const{foreignObject:a,svgRoot:b,styleElement:c,domElement:d}=this;a.setAttribute("width","10000"),a.setAttribute("height","10000"),a.style.overflow="hidden",b.appendChild(a),a.appendChild(c),a.appendChild(d),this.image=aO.DOMAdapter.get().createImage()}destroy(){this.svgRoot.remove(),this.foreignObject.remove(),this.styleElement.remove(),this.domElement.remove(),this.image.src="",this.image.remove(),this.svgRoot=null,this.foreignObject=null,this.styleElement=null,this.domElement=null,this.image=null,this.canvasAndContext=null}}async function aS(a){let b=await aO.DOMAdapter.get().fetch(a),c=await b.blob(),d=new FileReader;return await new Promise((a,b)=>{d.onloadend=()=>a(d.result),d.onerror=b,d.readAsDataURL(c)})}async function aT(a,b){let c=await aS(b);return`@font-face {
        font-family: "${a.fontFamily}";
        font-weight: ${a.fontWeight};
        font-style: ${a.fontStyle};
        src: url('${c}');
    }`}let aU=new Map;async function aV(a){let b=a.filter(a=>ag.Cache.has(`${a}-and-url`)).map(a=>{if(!aU.has(a)){let{entries:b}=ag.Cache.get(`${a}-and-url`),c=[];b.forEach(b=>{let d=b.url,e=b.faces.map(a=>({weight:a.weight,style:a.style}));c.push(...e.map(b=>aT({fontWeight:b.weight,fontStyle:b.style,fontFamily:a},d)))}),aU.set(a,Promise.all(c).then(a=>a.join("\n")))}return aU.get(a)});return(await Promise.all(b)).join("\n")}class aW{constructor(a){this._activeTextures={},this._renderer=a,this._createCanvas=a.type===aN.RendererType.WEBGPU}getTexture(a){return this.getTexturePromise(a)}getManagedTexture(a){let b=a.styleKey;if(this._activeTextures[b])return this._increaseReferenceCount(b),this._activeTextures[b].promise;let c=this._buildTexturePromise(a).then(a=>(this._activeTextures[b].texture=a,a));return this._activeTextures[b]={texture:null,promise:c,usageCount:1},c}getReferenceCount(a){return this._activeTextures[a]?.usageCount??null}_increaseReferenceCount(a){this._activeTextures[a].usageCount++}decreaseReferenceCount(a){let b=this._activeTextures[a];b&&(b.usageCount--,0===b.usageCount&&(b.texture?this._cleanUp(b.texture):b.promise.then(a=>{b.texture=a,this._cleanUp(b.texture)}).catch(()=>{(0,av.warn)("HTMLTextSystem: Failed to clean texture")}),this._activeTextures[a]=null))}getTexturePromise(a){return this._buildTexturePromise(a)}async _buildTexturePromise(a){var b;let c,{text:e,style:f,resolution:g,textureStyle:h}=a,i=o.BigPool.get(aR),j=function(a,b){let c=b.fontFamily,d=[],e={},f=a.match(/font-family:([^;"\s]+)/g);function g(a){e[a]||(d.push(a),e[a]=!0)}if(Array.isArray(c))for(let a=0;a<c.length;a++)g(c[a]);else g(c);for(let a in f&&f.forEach(a=>{g(a.split(":")[1].trim())}),b.tagStyles)g(b.tagStyles[a].fontFamily);return d}(e,f),k=await aV(j),l=function(a,b,c,e){e||(e=d||(d=new aR));let{domElement:f,styleElement:g,svgRoot:h}=e;f.innerHTML=`<style>${b.cssStyle};</style><div style='padding:0'>${a}</div>`,f.setAttribute("style","transform-origin: top left; display: inline-block"),c&&(g.textContent=c),document.body.appendChild(h);let i=f.getBoundingClientRect();h.remove();let j=2*b.padding;return{width:i.width-j,height:i.height-j}}(e,f,k,i),m=Math.ceil(Math.ceil(Math.max(1,l.width)+2*f.padding)*g),n=Math.ceil(Math.ceil(Math.max(1,l.height)+2*f.padding)*g),p=i.image;p.width=(0|m)+2,p.height=(0|n)+2;let q=function(a,b,c,d,e){let{domElement:f,styleElement:g,svgRoot:h}=e;f.innerHTML=`<style>${b.cssStyle}</style><div style='padding:0;'>${a}</div>`,f.setAttribute("style",`transform: scale(${c});transform-origin: top left; display: inline-block`),g.textContent=d;let{width:i,height:j}=e.image;return h.setAttribute("width",i.toString()),h.setAttribute("height",j.toString()),new XMLSerializer().serializeToString(h)}(e,f,g,k,i);await (b=function(){let{userAgent:a}=aO.DOMAdapter.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(a)}()&&j.length>0,new Promise(async a=>{b&&await new Promise(a=>setTimeout(a,100)),p.onload=()=>{a()},p.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(q)}`,p.crossOrigin="anonymous"})),this._createCanvas&&(c=function(a,b){let c=ax.CanvasPool.getOptimalCanvasAndContext(a.width,a.height,b),{context:d}=c;return d.clearRect(0,0,a.width,a.height),d.drawImage(a,0,0),c}(p,g));let r=ad(c?c.canvas:p,p.width-2,p.height-2,g);return h&&(r.source.style=h),this._createCanvas&&(this._renderer.texture.initSource(r.source),ax.CanvasPool.returnCanvasAndContext(c)),o.BigPool.return(i),r}returnTexturePromise(a){a.then(a=>{this._cleanUp(a)}).catch(()=>{(0,av.warn)("HTMLTextSystem: Failed to clean texture")})}_cleanUp(a){$.TexturePool.returnTexture(a,!0),a.source.resource=null,a.source.uploadMethodId="unknown"}destroy(){for(let a in this._renderer=null,this._activeTextures)this._activeTextures[a]&&this.returnTexturePromise(this._activeTextures[a].promise);this._activeTextures=null}}aW.extension={type:[g.ExtensionType.WebGLSystem,g.ExtensionType.WebGPUSystem,g.ExtensionType.CanvasSystem],name:"htmlText"},g.extensions.add(aW),g.extensions.add(aM),a.s([],95535);var aX=D;let aY=class a extends aX.Geometry{constructor(...b){let c=b[0]??{};c instanceof Float32Array&&((0,_.deprecation)(_.v8_0_0,"use new MeshGeometry({ positions, uvs, indices }) instead"),c={positions:c,uvs:b[1],indices:b[2]});const d=(c={...a.defaultOptions,...c}).positions||new Float32Array([0,0,1,0,1,1,0,1]);let e=c.uvs;e||(e=new Float32Array(c.positions?d.length:[0,0,1,0,1,1,0,1]));const f=c.indices||new Uint32Array([0,1,2,0,2,3]),g=c.shrinkBuffersToFit,h=new B.Buffer({data:d,label:"attribute-mesh-positions",shrinkToFit:g,usage:C.BufferUsage.VERTEX|C.BufferUsage.COPY_DST});super({attributes:{aPosition:{buffer:h,format:"float32x2",stride:8,offset:0},aUV:{buffer:new B.Buffer({data:e,label:"attribute-mesh-uvs",shrinkToFit:g,usage:C.BufferUsage.VERTEX|C.BufferUsage.COPY_DST}),format:"float32x2",stride:8,offset:0}},indexBuffer:new B.Buffer({data:f,label:"index-mesh-buffer",shrinkToFit:g,usage:C.BufferUsage.INDEX|C.BufferUsage.COPY_DST}),topology:c.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(a){this.attributes.aPosition.buffer.data=a}get uvs(){return this.attributes.aUV.buffer.data}set uvs(a){this.attributes.aUV.buffer.data=a}get indices(){return this.indexBuffer.data}set indices(a){this.indexBuffer.data=a}};aY.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let aZ=aY;var a$=a.i(77686),a_=M;let a0={name:"tiling-bit",vertex:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`
            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;

            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;
        `},fragment:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`

            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);
            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;
            var unclamped = coord;
            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);

            var bias = 0.;

            if(unclamped.x == coord.x && unclamped.y == coord.y)
            {
                bias = -32.;
            }

            outColor = textureSampleBias(uTexture, uSampler, coord, bias);
        `}},a1={name:"tiling-bit",vertex:{header:`
            uniform mat3 uTextureTransform;
            uniform vec4 uSizeAnchor;

        `,main:`
            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;

            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;
        `},fragment:{header:`
            uniform sampler2D uTexture;
            uniform mat3 uMapCoord;
            uniform vec4 uClampFrame;
            uniform vec2 uClampOffset;
        `,main:`

        vec2 coord = vUV + ceil(uClampOffset - vUV);
        coord = (uMapCoord * vec3(coord, 1.0)).xy;
        vec2 unclamped = coord;
        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0

        `}};class a2 extends a_.Shader{constructor(){e??(e=(0,aj.compileHighShaderGpuProgram)({name:"tiling-sprite-shader",bits:[a$.localUniformBit,a0,am.roundPixelsBit]})),f??(f=(0,aj.compileHighShaderGlProgram)({name:"tiling-sprite-shader",bits:[a$.localUniformBitGl,a1,am.roundPixelsBitGl]}));const a=new v.UniformGroup({uMapCoord:{value:new t.Matrix,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new t.Matrix,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:f,gpuProgram:e,resources:{localUniforms:new v.UniformGroup({uTransformMatrix:{value:new t.Matrix,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:a,uTexture:N.Texture.EMPTY.source,uSampler:N.Texture.EMPTY.source.style}})}updateUniforms(a,b,c,d,e,f){let g=this.resources.tilingUniforms,h=f.width,i=f.height,j=f.textureMatrix,k=g.uniforms.uTextureTransform;k.set(c.a*h/a,c.b*h/b,c.c*i/a,c.d*i/b,c.tx/a,c.ty/b),k.invert(),g.uniforms.uMapCoord=j.mapCoord,g.uniforms.uClampFrame=j.uClampFrame,g.uniforms.uClampOffset=j.uClampOffset,g.uniforms.uTextureTransform=k,g.uniforms.uSizeAnchor[0]=a,g.uniforms.uSizeAnchor[1]=b,g.uniforms.uSizeAnchor[2]=d,g.uniforms.uSizeAnchor[3]=e,f&&(this.resources.uTexture=f.source,this.resources.uSampler=f.source.style)}}let a3=new class extends aZ{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}};class a4{constructor(){this.canBatch=!0,this.geometry=new aZ({indices:a3.indices.slice(),positions:a3.positions.slice(),uvs:a3.uvs.slice()})}destroy(){this.geometry.destroy(),this.shader?.destroy()}}class a5{constructor(a){this._state=m.State.default2d,this._renderer=a,this._managedTilingSprites=new n.GCManagedHash({renderer:a,type:"renderable",name:"tilingSprite"})}validateRenderable(a){let b=this._getTilingSpriteData(a),c=b.canBatch;this._updateCanBatch(a);let d=b.canBatch;if(d&&d===c){let{batchableMesh:c}=b;return!c._batcher.checkAndUpdateTexture(c,a.texture)}return c!==d}addRenderable(a,b){let c=this._renderer.renderPipes.batch;this._updateCanBatch(a);let d=this._getTilingSpriteData(a),{geometry:e,canBatch:f}=d;if(f){d.batchableMesh||(d.batchableMesh=new x);let f=d.batchableMesh;a.didViewUpdate&&(this._updateBatchableMesh(a),f.geometry=e,f.renderable=a,f.transform=a.groupTransform,f.setTexture(a._texture)),f.roundPixels=this._renderer._roundPixels|a._roundPixels,c.addToBatch(f,b)}else c.break(b),d.shader||(d.shader=new a2),this.updateRenderable(a),b.add(a)}execute(a){let{shader:b}=this._getTilingSpriteData(a);b.groups[0]=this._renderer.globalUniforms.bindGroup;let c=b.resources.localUniforms.uniforms;c.uTransformMatrix=a.groupTransform,c.uRound=this._renderer._roundPixels|a._roundPixels,(0,p.color32BitToUniform)(a.groupColorAlpha,c.uColor,0),this._state.blendMode=(0,w.getAdjustedBlendModeBlend)(a.groupBlendMode,a.texture._source),this._renderer.encoder.draw({geometry:a3,shader:b,state:this._state})}updateRenderable(a){let b=this._getTilingSpriteData(a),{canBatch:c}=b;if(c){let{batchableMesh:c}=b;a.didViewUpdate&&this._updateBatchableMesh(a),c._batcher.updateElement(c)}else if(a.didViewUpdate){let{shader:c}=b;c.updateUniforms(a.width,a.height,a._tileTransform.matrix,a.anchor.x,a.anchor.y,a.texture)}}_getTilingSpriteData(a){return a._gpuData[this._renderer.uid]||this._initTilingSpriteData(a)}_initTilingSpriteData(a){let b=new a4;return b.renderable=a,a._gpuData[this._renderer.uid]=b,this._managedTilingSprites.add(a),b}_updateBatchableMesh(a){var b,c;let d,e,f,g,h,i,j,k,{geometry:l}=this._getTilingSpriteData(a),m=a.texture.source.style;"repeat"!==m.addressMode&&(m.addressMode="repeat",m.update()),b=l.uvs,e=(d=a.texture).frame.width,f=d.frame.height,g=0,h=0,a.applyAnchorToTexture&&(g=a.anchor.x,h=a.anchor.y),b[0]=b[6]=-g,b[2]=b[4]=1-g,b[1]=b[3]=-h,b[5]=b[7]=1-h,(i=t.Matrix.shared).copyFrom(a._tileTransform.matrix),i.tx/=a.width,i.ty/=a.height,i.invert(),i.scale(a.width/e,a.height/f),function(a,b,c,d){let e=0,f=a.length/2,g=d.a,h=d.b,i=d.c,j=d.d,k=d.tx,l=d.ty;for(c*=2;e<f;){let b=a[c],d=a[c+1];a[c]=g*b+i*d+k,a[c+1]=h*b+j*d+l,c+=2,e++}}(b,0,0,i),c=l.positions,j=a.anchor.x,k=a.anchor.y,c[0]=-j*a.width,c[1]=-k*a.height,c[2]=(1-j)*a.width,c[3]=-k*a.height,c[4]=(1-j)*a.width,c[5]=(1-k)*a.height,c[6]=-j*a.width,c[7]=(1-k)*a.height}destroy(){this._managedTilingSprites.destroy(),this._renderer=null}_updateCanBatch(a){let b=this._getTilingSpriteData(a),c=a.texture,d=!0;return this._renderer.type===aN.RendererType.WEBGL&&(d=this._renderer.context.supports.nonPowOf2wrapping),b.canBatch=c.textureMatrix.isSimple&&(d||c.source.isPowerOfTwo),b.canBatch}}a5.extension={type:[g.ExtensionType.WebGLPipes,g.ExtensionType.WebGPUPipes,g.ExtensionType.CanvasPipes],name:"tilingSprite"},g.extensions.add(a5),a.s([],11252);let a6=class a extends aZ{constructor(...a){super({});let b=a[0]??{};"number"==typeof b&&((0,_.deprecation)(_.v8_0_0,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),b={width:b,height:a[1],verticesX:a[2],verticesY:a[3]}),this.build(b)}build(b){b={...a.defaultOptions,...b},this.verticesX=this.verticesX??b.verticesX,this.verticesY=this.verticesY??b.verticesY,this.width=this.width??b.width,this.height=this.height??b.height;let c=this.verticesX*this.verticesY,d=[],e=[],f=[],g=this.verticesX-1,h=this.verticesY-1,i=this.width/g,j=this.height/h;for(let a=0;a<c;a++){let b=a%this.verticesX,c=a/this.verticesX|0;d.push(b*i,c*j),e.push(b/g,c/h)}let k=g*h;for(let a=0;a<k;a++){let b=a%g,c=a/g|0,d=c*this.verticesX+b,e=c*this.verticesX+b+1,h=(c+1)*this.verticesX+b,i=(c+1)*this.verticesX+b+1;f.push(d,e,h,e,i,h)}this.buffers[0].data=new Float32Array(d),this.buffers[1].data=new Float32Array(e),this.indexBuffer.data=new Uint32Array(f),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};a6.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let a7=a6,a8=class a extends a7{constructor(b={}){super({width:(b={...a.defaultOptions,...b}).width,height:b.height,verticesX:4,verticesY:4}),this.update(b)}update(a){this.width=a.width??this.width,this.height=a.height??this.height,this._originalWidth=a.originalWidth??this._originalWidth,this._originalHeight=a.originalHeight??this._originalHeight,this._leftWidth=a.leftWidth??this._leftWidth,this._rightWidth=a.rightWidth??this._rightWidth,this._topHeight=a.topHeight??this._topHeight,this._bottomHeight=a.bottomHeight??this._bottomHeight,this._anchorX=a.anchor?.x,this._anchorY=a.anchor?.y,this.updateUvs(),this.updatePositions()}updatePositions(){let a=this.positions,{width:b,height:c,_leftWidth:d,_rightWidth:e,_topHeight:f,_bottomHeight:g,_anchorX:h,_anchorY:i}=this,j=d+e,k=f+g,l=Math.min(b>j?1:b/j,c>k?1:c/k),m=h*b,n=i*c;a[0]=a[8]=a[16]=a[24]=-m,a[2]=a[10]=a[18]=a[26]=d*l-m,a[4]=a[12]=a[20]=a[28]=b-e*l-m,a[6]=a[14]=a[22]=a[30]=b-m,a[1]=a[3]=a[5]=a[7]=-n,a[9]=a[11]=a[13]=a[15]=f*l-n,a[17]=a[19]=a[21]=a[23]=c-g*l-n,a[25]=a[27]=a[29]=a[31]=c-n,this.getBuffer("aPosition").update()}updateUvs(){let a=this.uvs;a[0]=a[8]=a[16]=a[24]=0,a[1]=a[3]=a[5]=a[7]=0,a[6]=a[14]=a[22]=a[30]=1,a[25]=a[27]=a[29]=a[31]=1;let b=1/this._originalWidth,c=1/this._originalHeight;a[2]=a[10]=a[18]=a[26]=b*this._leftWidth,a[9]=a[11]=a[13]=a[15]=c*this._topHeight,a[4]=a[12]=a[20]=a[28]=1-b*this._rightWidth,a[17]=a[19]=a[21]=a[23]=1-c*this._bottomHeight,this.getBuffer("aUV").update()}};a8.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};class a9 extends x{constructor(){super(),this.geometry=new a8}destroy(){this.geometry.destroy()}}class ba{constructor(a){this._renderer=a,this._managedSprites=new n.GCManagedHash({renderer:a,type:"renderable",name:"nineSliceSprite"})}addRenderable(a,b){let c=this._getGpuSprite(a);a.didViewUpdate&&this._updateBatchableSprite(a,c),this._renderer.renderPipes.batch.addToBatch(c,b)}updateRenderable(a){let b=this._getGpuSprite(a);a.didViewUpdate&&this._updateBatchableSprite(a,b),b._batcher.updateElement(b)}validateRenderable(a){let b=this._getGpuSprite(a);return!b._batcher.checkAndUpdateTexture(b,a._texture)}_updateBatchableSprite(a,b){b.geometry.update(a),b.setTexture(a._texture)}_getGpuSprite(a){return a._gpuData[this._renderer.uid]||this._initGPUSprite(a)}_initGPUSprite(a){let b=a._gpuData[this._renderer.uid]=new a9;return b.renderable=a,b.transform=a.groupTransform,b.texture=a._texture,b.roundPixels=this._renderer._roundPixels|a._roundPixels,this._managedSprites.add(a),a.didViewUpdate||this._updateBatchableSprite(a,b),b}destroy(){this._managedSprites.destroy(),this._renderer=null}}ba.extension={type:[g.ExtensionType.WebGLPipes,g.ExtensionType.WebGPUPipes,g.ExtensionType.CanvasPipes],name:"nineSliceSprite"},g.extensions.add(ba),a.s([],46155);class bb{constructor(a){this._renderer=a}push(a,b,c){this._renderer.renderPipes.batch.break(c),c.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:b,filterEffect:a})}pop(a,b,c){this._renderer.renderPipes.batch.break(c),c.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(a){"pushFilter"===a.action?this._renderer.filter.push(a):"popFilter"===a.action&&this._renderer.filter.pop()}destroy(){this._renderer=null}}bb.extension={type:[g.ExtensionType.WebGLPipes,g.ExtensionType.WebGPUPipes,g.ExtensionType.CanvasPipes],name:"filter"};var bc=a.i(21437),bd="struct GlobalFilterUniforms {\n  uInputSize: vec4<f32>,\n  uInputPixel: vec4<f32>,\n  uInputClamp: vec4<f32>,\n  uOutputFrame: vec4<f32>,\n  uGlobalFrame: vec4<f32>,\n  uOutputTexture: vec4<f32>,\n};\n\n@group(0) @binding(0) var <uniform> gfu: GlobalFilterUniforms;\n@group(0) @binding(1) var uTexture: texture_2d<f32>;\n@group(0) @binding(2) var uSampler: sampler;\n\nstruct VSOutput {\n  @builtin(position) position: vec4<f32>,\n  @location(0) uv: vec2<f32>\n};\n\nfn filterVertexPosition(aPosition: vec2<f32>) -> vec4<f32>\n{\n    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;\n\n    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0 * gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nfn filterTextureCoord(aPosition: vec2<f32>) -> vec2<f32>\n{\n    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);\n}\n\n@vertex\nfn mainVertex(\n  @location(0) aPosition: vec2<f32>,\n) -> VSOutput {\n  return VSOutput(\n   filterVertexPosition(aPosition),\n   filterTextureCoord(aPosition)\n  );\n}\n\n@fragment\nfn mainFragment(\n  @location(0) uv: vec2<f32>,\n) -> @location(0) vec4<f32> {\n    return textureSample(uTexture, uSampler, uv);\n}\n";class be extends bc.Filter{constructor(){super({gpuProgram:L.GpuProgram.from({vertex:{source:bd,entryPoint:"mainVertex"},fragment:{source:bd,entryPoint:"mainFragment"},name:"passthrough-filter"}),glProgram:K.GlProgram.from({vertex:"in vec2 aPosition;\nout vec2 vTextureCoord;\n\nuniform vec4 uInputSize;\nuniform vec4 uOutputFrame;\nuniform vec4 uOutputTexture;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;\n    \n    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;\n    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;\n\n    return vec4(position, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aPosition * (uOutputFrame.zw * uInputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",fragment:"in vec2 vTextureCoord;\nout vec4 finalColor;\nuniform sampler2D uTexture;\nvoid main() {\n    finalColor = texture(uTexture, vTextureCoord);\n}\n",name:"passthrough-filter"})})}}let bf=new t.Matrix,bg=new D.Geometry({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:8,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class bh{constructor(){this.skip=!1,this.inputTexture=null,this.backTexture=null,this.filters=null,this.bounds=new ab.Bounds,this.container=null,this.blendRequired=!1,this.outputRenderSurface=null,this.globalFrame={x:0,y:0,width:0,height:0},this.firstEnabledIndex=-1,this.lastEnabledIndex=-1}}class bi{constructor(a){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new v.UniformGroup({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new u.BindGroup({}),this.renderer=a}get activeBackTexture(){return this._activeFilterData?.backTexture}push(a){let b=this.renderer,c=a.filterEffect.filters,d=this._pushFilterData();d.skip=!1,d.filters=c,d.container=a.container,d.outputRenderSurface=b.renderTarget.renderSurface;let e=b.renderTarget.renderTarget.colorTexture.source,f=e.resolution,g=e.antialias;if(c.every(a=>!a.enabled)){d.skip=!0;return}let h=d.bounds;if(this._calculateFilterArea(a,h),this._calculateFilterBounds(d,b.renderTarget.rootViewPort,g,f,1),d.skip)return;let i=this._getPreviousFilterData(),j=this._findFilterResolution(f),k=0,l=0;i&&(k=i.bounds.minX,l=i.bounds.minY),this._calculateGlobalFrame(d,k,l,j,e.width,e.height),this._setupFilterTextures(d,h,b,i)}generateFilteredTexture({texture:a,filters:b}){let c=this._pushFilterData();this._activeFilterData=c,c.skip=!1,c.filters=b;let d=a.source,e=d.resolution,f=d.antialias;if(b.every(a=>!a.enabled))return c.skip=!0,a;let g=c.bounds;if(g.addRect(a.frame),this._calculateFilterBounds(c,g.rectangle,f,e,0),c.skip)return a;this._calculateGlobalFrame(c,0,0,e,d.width,d.height),c.outputRenderSurface=$.TexturePool.getOptimalTexture(g.width,g.height,c.resolution,c.antialias),c.backTexture=N.Texture.EMPTY,c.inputTexture=a,this.renderer.renderTarget.finishRenderPass(),this._applyFiltersToTexture(c,!0);let h=c.outputRenderSurface;return h.source.alphaMode="premultiplied-alpha",h}pop(){let a=this.renderer,b=this._popFilterData();b.skip||(a.globalUniforms.pop(),a.renderTarget.finishRenderPass(),this._activeFilterData=b,this._applyFiltersToTexture(b,!1),b.blendRequired&&$.TexturePool.returnTexture(b.backTexture),$.TexturePool.returnTexture(b.inputTexture))}getBackTexture(a,b,c){let d=a.colorTexture.source._resolution,e=$.TexturePool.getOptimalTexture(b.width,b.height,d,!1),f=b.minX,g=b.minY;c&&(f-=c.minX,g-=c.minY),f=Math.floor(f*d),g=Math.floor(g*d);let h=Math.ceil(b.width*d),i=Math.ceil(b.height*d);return this.renderer.renderTarget.copyToTexture(a,e,{x:f,y:g},{width:h,height:i},{x:0,y:0}),e}applyFilter(a,b,c,d){let e=this.renderer,f=this._activeFilterData,g=f.outputRenderSurface===c,h=e.renderTarget.rootRenderTarget.colorTexture.source._resolution,i=this._findFilterResolution(h),j=0,k=0;if(g){let a=this._findPreviousFilterOffset();j=a.x,k=a.y}this._updateFilterUniforms(b,c,f,j,k,i,g,d);let l=a.enabled?a:this._getPassthroughFilter();this._setupBindGroupsAndRender(l,b,e)}calculateSpriteMatrix(a,b){let c=this._activeFilterData,d=a.set(c.inputTexture._source.width,0,0,c.inputTexture._source.height,c.bounds.minX,c.bounds.minY),e=b.worldTransform.copyTo(t.Matrix.shared),f=b.renderGroup||b.parentRenderGroup;return f&&f.cacheToLocalTransform&&e.prepend(f.cacheToLocalTransform),e.invert(),d.prepend(e),d.scale(1/b.texture.orig.width,1/b.texture.orig.height),d.translate(b.anchor.x,b.anchor.y),d}destroy(){this._passthroughFilter?.destroy(!0),this._passthroughFilter=null}_getPassthroughFilter(){return this._passthroughFilter??(this._passthroughFilter=new be),this._passthroughFilter}_setupBindGroupsAndRender(a,b,c){if(c.renderPipes.uniformBatch){let a=c.renderPipes.uniformBatch.getUboResource(this._filterGlobalUniforms);this._globalFilterBindGroup.setResource(a,0)}else this._globalFilterBindGroup.setResource(this._filterGlobalUniforms,0);this._globalFilterBindGroup.setResource(b.source,1),this._globalFilterBindGroup.setResource(b.source.style,2),a.groups[0]=this._globalFilterBindGroup,c.encoder.draw({geometry:bg,shader:a,state:a._state,topology:"triangle-list"}),c.type===aN.RendererType.WEBGL&&c.renderTarget.finishRenderPass()}_setupFilterTextures(a,b,c,d){if(a.backTexture=N.Texture.EMPTY,a.inputTexture=$.TexturePool.getOptimalTexture(b.width,b.height,a.resolution,a.antialias),a.blendRequired){c.renderTarget.finishRenderPass();let e=c.renderTarget.getRenderTarget(a.outputRenderSurface);a.backTexture=this.getBackTexture(e,b,d?.bounds)}c.renderTarget.bind(a.inputTexture,!0),c.globalUniforms.push({offset:b})}_calculateGlobalFrame(a,b,c,d,e,f){let g=a.globalFrame;g.x=b*d,g.y=c*d,g.width=e*d,g.height=f*d}_updateFilterUniforms(a,b,c,d,e,f,g,h){let i=this._filterGlobalUniforms.uniforms,j=i.uOutputFrame,k=i.uInputSize,l=i.uInputPixel,m=i.uInputClamp,n=i.uGlobalFrame,o=i.uOutputTexture;g?(j[0]=c.bounds.minX-d,j[1]=c.bounds.minY-e):(j[0]=0,j[1]=0),j[2]=a.frame.width,j[3]=a.frame.height,k[0]=a.source.width,k[1]=a.source.height,k[2]=1/k[0],k[3]=1/k[1],l[0]=a.source.pixelWidth,l[1]=a.source.pixelHeight,l[2]=1/l[0],l[3]=1/l[1],m[0]=.5*l[2],m[1]=.5*l[3],m[2]=a.frame.width*k[2]-.5*l[2],m[3]=a.frame.height*k[3]-.5*l[3];let p=this.renderer.renderTarget.rootRenderTarget.colorTexture;n[0]=d*f,n[1]=e*f,n[2]=p.source.width*f,n[3]=p.source.height*f,b instanceof N.Texture&&(b.source.resource=null);let q=this.renderer.renderTarget.getRenderTarget(b);this.renderer.renderTarget.bind(b,!!h),b instanceof N.Texture?(o[0]=b.frame.width,o[1]=b.frame.height):(o[0]=q.width,o[1]=q.height),o[2]=q.isRoot?-1:1,this._filterGlobalUniforms.update()}_findFilterResolution(a){let b=this._filterStackIndex-1;for(;b>0&&this._filterStack[b].skip;)--b;return b>0&&this._filterStack[b].inputTexture?this._filterStack[b].inputTexture.source._resolution:a}_findPreviousFilterOffset(){let a=0,b=0,c=this._filterStackIndex;for(;c>0;){c--;let d=this._filterStack[c];if(!d.skip){a=d.bounds.minX,b=d.bounds.minY;break}}return{x:a,y:b}}_calculateFilterArea(a,b){if(a.renderables?!function(a,b){b.clear();let c=b.matrix;for(let c=0;c<a.length;c++){let d=a[c];if(d.globalDisplayStatus<7)continue;let e=d.renderGroup??d.parentRenderGroup;e?.isCachedAsTexture?b.matrix=bf.copyFrom(e.textureOffsetInverseTransform).append(d.worldTransform):e?._parentCacheAsTextureRenderGroup?b.matrix=bf.copyFrom(e._parentCacheAsTextureRenderGroup.inverseWorldTransform).append(d.groupTransform):b.matrix=d.worldTransform,b.addBounds(d.bounds)}b.matrix=c}(a.renderables,b):a.filterEffect.filterArea?(b.clear(),b.addRect(a.filterEffect.filterArea),b.applyMatrix(a.container.worldTransform)):a.container.getFastGlobalBounds(!0,b),a.container){let c=(a.container.renderGroup||a.container.parentRenderGroup).cacheToLocalTransform;c&&b.applyMatrix(c)}}_applyFiltersToTexture(a,b){let c=a.inputTexture,d=a.bounds,e=a.filters,f=a.firstEnabledIndex,g=a.lastEnabledIndex;if(this._globalFilterBindGroup.setResource(c.source.style,2),this._globalFilterBindGroup.setResource(a.backTexture.source,3),f===g)e[f].apply(this,c,a.outputRenderSurface,b);else{let c=a.inputTexture,h=$.TexturePool.getOptimalTexture(d.width,d.height,c.source._resolution,!1),i=h;for(let a=f;a<g;a++){let b=e[a];if(!b.enabled)continue;b.apply(this,c,i,!0);let d=c;c=i,i=d}e[g].apply(this,c,a.outputRenderSurface,b),$.TexturePool.returnTexture(h)}}_calculateFilterBounds(a,b,c,d,e){let f=this.renderer,g=a.bounds,h=a.filters,i=1/0,j=0,k=!0,l=!1,m=!1,n=!0,o=-1,p=-1;for(let a=0;a<h.length;a++){let b=h[a];if(b.enabled){if(-1===o&&(o=a),p=a,i=Math.min(i,"inherit"===b.resolution?d:b.resolution),j+=b.padding,"off"===b.antialias?k=!1:"inherit"===b.antialias&&k&&(k=c),b.clipToViewport||(n=!1),!(b.compatibleRenderers&f.type)){m=!1;break}if(b.blendRequired&&!(f.backBuffer?.useBackBuffer??!0)){(0,av.warn)("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),m=!1;break}m=!0,l||(l=b.blendRequired)}}if(!m||(n&&g.fitBounds(0,b.width/d,0,b.height/d),g.scale(i).ceil().scale(1/i).pad((0|j)*e),!g.isPositive)){a.skip=!0;return}a.antialias=k,a.resolution=i,a.blendRequired=l,a.firstEnabledIndex=o,a.lastEnabledIndex=p}_popFilterData(){return this._filterStackIndex--,this._filterStack[this._filterStackIndex]}_getPreviousFilterData(){let a,b=this._filterStackIndex-1;for(;b>0&&(b--,(a=this._filterStack[b]).skip););return a}_pushFilterData(){let a=this._filterStack[this._filterStackIndex];return a||(a=this._filterStack[this._filterStackIndex]=new bh),this._filterStackIndex++,a}}bi.extension={type:[g.ExtensionType.WebGLSystem,g.ExtensionType.WebGPUSystem],name:"filter"},g.extensions.add(bi),g.extensions.add(bb),a.s([],32419)}];

//# sourceMappingURL=node_modules_pixi_js_lib_app_init_mjs_d9b553b7._.js.map